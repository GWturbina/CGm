<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>CardGift - –ü—Ä–∏—Å–æ–µ–¥–∏–Ω–∏—Ç—å—Å—è</title>
    
    <!-- Open Graph -->
    <meta property="og:title" content="CardGift - –ü—Ä–∏–≥–ª–∞—à–µ–Ω–∏–µ">
    <meta property="og:description" content="–ü—Ä–∏—Å–æ–µ–¥–∏–Ω—è–π—Ç–µ—Å—å –∫ CardGift - –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—É –Ω–æ–≤–æ–≥–æ –ø–æ–∫–æ–ª–µ–Ω–∏—è">
    <meta property="og:type" content="website">
    
    <!-- Favicon -->
    <link rel="icon" type="image/png" href="/images/favicon.png">
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            background: linear-gradient(135deg, #0a0a1a 0%, #1a1a2e 50%, #16213e 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
            color: #fff;
        }
        
        .container {
            width: 100%;
            max-width: 420px;
            background: rgba(26, 26, 46, 0.95);
            border-radius: 24px;
            padding: 40px 30px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
            border: 1px solid rgba(255, 215, 0, 0.2);
        }
        
        .logo {
            text-align: center;
            margin-bottom: 30px;
        }
        
        .logo img {
            width: 80px;
            height: 80px;
            border-radius: 20px;
        }
        
        .logo-icon {
            font-size: 64px;
            margin-bottom: 10px;
        }
        
        h1 {
            text-align: center;
            color: #FFD700;
            font-size: 24px;
            margin-bottom: 10px;
        }
        
        .subtitle {
            text-align: center;
            color: #888;
            font-size: 14px;
            margin-bottom: 30px;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-group label {
            display: block;
            color: #FFD700;
            font-size: 14px;
            margin-bottom: 8px;
            font-weight: 500;
        }
        
        .form-input {
            width: 100%;
            padding: 15px 18px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            color: #fff;
            font-size: 16px;
            transition: all 0.3s;
        }
        
        .form-input:focus {
            outline: none;
            border-color: #FFD700;
            background: rgba(255, 215, 0, 0.05);
        }
        
        .form-input::placeholder {
            color: #666;
        }
        
        .form-select {
            width: 100%;
            padding: 15px 18px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            color: #fff;
            font-size: 16px;
            cursor: pointer;
            appearance: none;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='24' height='24' viewBox='0 0 24 24' fill='none' stroke='%23FFD700' stroke-width='2'%3E%3Cpolyline points='6,9 12,15 18,9'%3E%3C/polyline%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 15px center;
            background-size: 18px;
        }
        
        .form-select:focus {
            outline: none;
            border-color: #FFD700;
        }
        
        .form-select option {
            background: #1a1a2e;
            color: #fff;
            padding: 10px;
        }
        
        .form-hint {
            font-size: 12px;
            color: #666;
            margin-top: 6px;
        }
        
        .checkbox-group {
            display: flex;
            align-items: flex-start;
            gap: 12px;
            padding: 15px;
            background: rgba(255, 215, 0, 0.05);
            border: 1px solid rgba(255, 215, 0, 0.2);
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .checkbox-group:hover {
            background: rgba(255, 215, 0, 0.1);
        }
        
        .checkbox-group input[type="checkbox"] {
            width: 22px;
            height: 22px;
            margin-top: 2px;
            cursor: pointer;
            accent-color: #FFD700;
        }
        
        .checkbox-group span {
            color: #ccc;
            font-size: 13px;
            line-height: 1.5;
        }
        
        .checkbox-group span a {
            color: #FFD700;
            text-decoration: underline;
        }
        
        .submit-btn {
            width: 100%;
            padding: 18px;
            background: linear-gradient(45deg, #FFD700, #FFA500);
            border: none;
            border-radius: 14px;
            color: #000;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            margin-top: 25px;
        }
        
        .submit-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 30px rgba(255, 215, 0, 0.3);
        }
        
        .submit-btn:disabled {
            background: #444;
            color: #888;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        
        .skip-link {
            display: block;
            text-align: center;
            color: #666;
            font-size: 14px;
            margin-top: 20px;
            text-decoration: none;
            transition: color 0.3s;
        }
        
        .skip-link:hover {
            color: #FFD700;
        }
        
        .error-msg {
            color: #f44336;
            font-size: 12px;
            margin-top: 6px;
            display: none;
        }
        
        .error-msg.show {
            display: block;
        }
        
        .success-container {
            text-align: center;
            display: none;
        }
        
        .success-icon {
            font-size: 80px;
            margin-bottom: 20px;
        }
        
        .success-title {
            color: #4CAF50;
            font-size: 24px;
            margin-bottom: 15px;
        }
        
        .success-text {
            color: #888;
            font-size: 14px;
            line-height: 1.6;
            margin-bottom: 25px;
        }
        
        .toast {
            position: fixed;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
            background: #333;
            color: #fff;
            padding: 12px 24px;
            border-radius: 30px;
            font-size: 14px;
            z-index: 10000;
            opacity: 0;
            transition: opacity 0.3s;
        }
        
        .toast.show {
            opacity: 1;
        }
        
        .toast.error {
            background: #f44336;
        }
        
        .toast.success {
            background: #4CAF50;
        }
        
        /* –¢–∞–π–º–µ—Ä –∑–∞—â–∏—Ç—ã –æ—Ç —Å–ø–∞–º–∞ */
        .timer-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.9);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 10000;
        }
        
        .timer-box {
            text-align: center;
            color: #fff;
        }
        
        .timer-box .timer-count {
            font-size: 64px;
            color: #FFD700;
            font-weight: bold;
        }
        
        .timer-box p {
            color: #888;
            margin-top: 15px;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- –§–æ—Ä–º–∞ -->
        <div id="formContainer">
            <div class="logo">
                <div class="logo-icon">üéÅ</div>
            </div>
            
            <h1>–ü—Ä–∏—Å–æ–µ–¥–∏–Ω—è–π—Ç–µ—Å—å!</h1>
            <p class="subtitle">–û—Å—Ç–∞–≤—å—Ç–µ –∫–æ–Ω—Ç–∞–∫—Ç, —á—Ç–æ–±—ã –ø–æ–ª—É—á–∏—Ç—å –¥–æ—Å—Ç—É–ø –∫ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞–º</p>
            
            <form id="inviteForm" onsubmit="return submitInviteForm(event)">
                <div class="form-group">
                    <label>üë§ –í–∞—à–µ –∏–º—è:</label>
                    <input type="text" id="inviteName" class="form-input" placeholder="–ö–∞–∫ –∫ –≤–∞–º –æ–±—Ä–∞—â–∞—Ç—å—Å—è?" required>
                    <div class="form-hint">–í–≤–µ–¥–∏—Ç–µ –∏–º—è –∏–ª–∏ –Ω–∏–∫–Ω–µ–π–º</div>
                </div>
                
                <div class="form-group">
                    <label>üì± –ì–¥–µ –≤–∞—Å –Ω–∞–π—Ç–∏:</label>
                    <select id="inviteMessenger" class="form-select" required onchange="updateContactPlaceholder()">
                        <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –º–µ—Å—Å–µ–Ω–¥–∂–µ—Ä</option>
                        <option value="telegram">üì± Telegram</option>
                        <option value="whatsapp">üí¨ WhatsApp</option>
                        <option value="viber">üìû Viber</option>
                        <option value="instagram">üì∑ Instagram</option>
                        <option value="facebook">üìò Facebook</option>
                        <option value="tiktok">üéµ TikTok</option>
                        <option value="email">üìß Email</option>
                        <option value="phone">üìû –¢–µ–ª–µ—Ñ–æ–Ω</option>
                    </select>
                    <div class="form-hint">–í—ã–±–µ—Ä–∏—Ç–µ —É–¥–æ–±–Ω—ã–π —Å–ø–æ—Å–æ–± —Å–≤—è–∑–∏</div>
                </div>
                
                <div class="form-group">
                    <label>üìù –ö–æ–Ω—Ç–∞–∫—Ç:</label>
                    <input type="text" id="inviteContact" class="form-input" placeholder="@username –∏–ª–∏ +380..." required>
                    <div id="contactError" class="error-msg"></div>
                    <div id="contactHint" class="form-hint">–í–≤–µ–¥–∏—Ç–µ –≤–∞—à username –∏–ª–∏ –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞</div>
                </div>
                
                <div class="form-group">
                    <label class="checkbox-group">
                        <input type="checkbox" id="invitePushConsent">
                        <span>–Ø –¥–∞—é —Å–æ–≥–ª–∞—Å–∏–µ –Ω–∞ –ø–æ–ª—É—á–µ–Ω–∏–µ <a href="#" onclick="showPrivacyInfo(); return false;">—É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π</a> –∏ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π.</span>
                    </label>
                </div>
                
                <button type="submit" class="submit-btn" id="submitBtn">
                    üéÅ –ü—Ä–∏—Å–æ–µ–¥–∏–Ω–∏—Ç—å—Å—è
                </button>
                
                <a href="#" class="skip-link" onclick="skipForm(); return false;">–ü–æ–∑–∂–µ</a>
            </form>
        </div>
        
        <!-- –£—Å–ø–µ—à–Ω–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞ -->
        <div id="successContainer" class="success-container">
            <div class="success-icon">üéâ</div>
            <h2 class="success-title">–û—Ç–ª–∏—á–Ω–æ!</h2>
            <p class="success-text">
                –í–∞—à –∫–æ–Ω—Ç–∞–∫—Ç —Å–æ—Ö—Ä–∞–Ω—ë–Ω.<br>
                –°–∫–æ—Ä–æ –≤—ã –ø–æ–ª—É—á–∏—Ç–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—è—Ö CardGift!
            </p>
            <button onclick="window.location.href='/'" class="submit-btn">
                üè† –ù–∞ –≥–ª–∞–≤–Ω—É—é
            </button>
        </div>
    </div>
    
    <!-- –¢–∞–π–º–µ—Ä –∑–∞—â–∏—Ç—ã –æ—Ç —Å–ø–∞–º–∞ -->
    <div id="timerOverlay" class="timer-overlay">
        <div class="timer-box">
            <div class="timer-count" id="timerCount">60</div>
            <p>–ü–æ–¥–æ–∂–¥–∏—Ç–µ –ø–µ—Ä–µ–¥ –ø–æ–≤—Ç–æ—Ä–Ω–æ–π –æ—Ç–ø—Ä–∞–≤–∫–æ–π</p>
        </div>
    </div>
    
    <!-- Toast —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è -->
    <div id="toast" class="toast"></div>
    
    <script>
        // Supabase config
        const SUPABASE_URL = 'https://imgpysvdosdsqucoghqa.supabase.co';
        const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImltZ3B5c3Zkb3Nkc3F1Y29naHFhIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Mzc2NTQ0NTIsImV4cCI6MjA1MzIzMDQ1Mn0.yKNo0GfMffZCFf9AhgBJfMSBBNIBfkjWi6LMj7s_yzY';
        
        // –ü–æ–ª—É—á–∞–µ–º ref –∏–∑ URL
        const urlParams = new URLSearchParams(window.location.search);
        const refId = urlParams.get('ref') || 'direct';
        
        console.log('üì® Invite page loaded, ref:', refId);
        
        // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–∞–π–º–µ—Ä–∞ (–∑–∞—â–∏—Ç–∞ –æ—Ç —Å–ø–∞–º–∞)
        const COOLDOWN_KEY = 'cardgift_invite_cooldown';
        const COOLDOWN_SECONDS = 60;
        
        function checkCooldown() {
            const lastSubmit = localStorage.getItem(COOLDOWN_KEY);
            if (lastSubmit) {
                const elapsed = (Date.now() - parseInt(lastSubmit)) / 1000;
                if (elapsed < COOLDOWN_SECONDS) {
                    return Math.ceil(COOLDOWN_SECONDS - elapsed);
                }
            }
            return 0;
        }
        
        function startCooldown() {
            localStorage.setItem(COOLDOWN_KEY, Date.now().toString());
        }
        
        function showTimer(seconds) {
            const overlay = document.getElementById('timerOverlay');
            const counter = document.getElementById('timerCount');
            overlay.style.display = 'flex';
            
            let remaining = seconds;
            counter.textContent = remaining;
            
            const interval = setInterval(() => {
                remaining--;
                counter.textContent = remaining;
                
                if (remaining <= 0) {
                    clearInterval(interval);
                    overlay.style.display = 'none';
                }
            }, 1000);
        }
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ placeholder –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –º–µ—Å—Å–µ–Ω–¥–∂–µ—Ä–∞
        function updateContactPlaceholder() {
            const messenger = document.getElementById('inviteMessenger').value;
            const input = document.getElementById('inviteContact');
            const hint = document.getElementById('contactHint');
            
            const placeholders = {
                telegram: { ph: '@username', hint: '–í–∞—à Telegram username (–Ω–∞–ø—Ä–∏–º–µ—Ä @myname)' },
                whatsapp: { ph: '+380501234567', hint: '–ù–æ–º–µ—Ä –≤ –º–µ–∂–¥—É–Ω–∞—Ä–æ–¥–Ω–æ–º —Ñ–æ—Ä–º–∞—Ç–µ (+XXX...)' },
                viber: { ph: '+380501234567', hint: '–ù–æ–º–µ—Ä –≤ –º–µ–∂–¥—É–Ω–∞—Ä–æ–¥–Ω–æ–º —Ñ–æ—Ä–º–∞—Ç–µ (+XXX...)' },
                instagram: { ph: '@username', hint: '–í–∞—à Instagram username' },
                facebook: { ph: 'username –∏–ª–∏ —Å—Å—ã–ª–∫–∞', hint: '–í–∞—à Facebook username –∏–ª–∏ —Å—Å—ã–ª–∫–∞ –Ω–∞ –ø—Ä–æ—Ñ–∏–ª—å' },
                tiktok: { ph: '@username', hint: '–í–∞—à TikTok username' },
                email: { ph: 'email@example.com', hint: '–í–∞—à email –∞–¥—Ä–µ—Å' },
                phone: { ph: '+380501234567', hint: '–ù–æ–º–µ—Ä –≤ –º–µ–∂–¥—É–Ω–∞—Ä–æ–¥–Ω–æ–º —Ñ–æ—Ä–º–∞—Ç–µ (+XXX...)' }
            };
            
            const config = placeholders[messenger] || { ph: '@username –∏–ª–∏ +380...', hint: '–í–≤–µ–¥–∏—Ç–µ –∫–æ–Ω—Ç–∞–∫—Ç' };
            input.placeholder = config.ph;
            hint.textContent = config.hint;
        }
        
        // –í–∞–ª–∏–¥–∞—Ü–∏—è –∫–æ–Ω—Ç–∞–∫—Ç–∞
        function validateContact(platform, contact) {
            const result = { valid: false, error: '', normalized: contact };
            
            if (!contact || contact.trim().length < 2) {
                result.error = '–ö–æ–Ω—Ç–∞–∫—Ç —Å–ª–∏—à–∫–æ–º –∫–æ—Ä–æ—Ç–∫–∏–π';
                return result;
            }
            
            switch (platform) {
                case 'phone':
                case 'whatsapp':
                case 'viber':
                    const phoneClean = contact.replace(/[\s\-\(\)]/g, '');
                    if (!phoneClean.startsWith('+')) {
                        result.error = '–ù–æ–º–µ—Ä –¥–æ–ª–∂–µ–Ω –Ω–∞—á–∏–Ω–∞—Ç—å—Å—è —Å + (–Ω–∞–ø—Ä–∏–º–µ—Ä +380501234567)';
                        return result;
                    }
                    const digits = phoneClean.replace(/\D/g, '');
                    if (digits.length < 10 || digits.length > 15) {
                        result.error = '–ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –Ω–æ–º–µ—Ä–∞ (10-15 —Ü–∏—Ñ—Ä)';
                        return result;
                    }
                    result.normalized = '+' + digits;
                    result.valid = true;
                    break;
                    
                case 'email':
                    const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
                    if (!emailRegex.test(contact)) {
                        result.error = '–ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç email';
                        return result;
                    }
                    result.normalized = contact.toLowerCase();
                    result.valid = true;
                    break;
                    
                case 'telegram':
                    let tg = contact.startsWith('@') ? contact : '@' + contact;
                    if (tg.length < 6) {
                        result.error = 'Username —Å–ª–∏—à–∫–æ–º –∫–æ—Ä–æ—Ç–∫–∏–π (–º–∏–Ω–∏–º—É–º 5 —Å–∏–º–≤–æ–ª–æ–≤)';
                        return result;
                    }
                    if (!/^@[a-zA-Z0-9_]+$/.test(tg)) {
                        result.error = 'Username –º–æ–∂–µ—Ç —Å–æ–¥–µ—Ä–∂–∞—Ç—å —Ç–æ–ª—å–∫–æ –±—É–∫–≤—ã, —Ü–∏—Ñ—Ä—ã –∏ _';
                        return result;
                    }
                    result.normalized = tg.toLowerCase();
                    result.valid = true;
                    break;
                    
                default:
                    if (contact.length < 3) {
                        result.error = '–ö–æ–Ω—Ç–∞–∫—Ç —Å–ª–∏—à–∫–æ–º –∫–æ—Ä–æ—Ç–∫–∏–π';
                        return result;
                    }
                    result.valid = true;
            }
            
            return result;
        }
        
        // Toast —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
        function showToast(message, type = 'info') {
            const toast = document.getElementById('toast');
            toast.textContent = message;
            toast.className = 'toast ' + type + ' show';
            
            setTimeout(() => {
                toast.classList.remove('show');
            }, 3000);
        }
        
        // –ú–æ–¥–∞–ª–∫–∞ —Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –æ –ø—Ä–∏–≤–∞—Ç–Ω–æ—Å—Ç–∏
        function showPrivacyInfo() {
            alert('–ú—ã –∏—Å–ø–æ–ª—å–∑—É–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è —Ç–æ–ª—å–∫–æ –¥–ª—è –∏–Ω—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏—è –æ –≤–∞–∂–Ω—ã—Ö –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è—Ö –∏ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è—Ö. –í–∞—à–∏ –¥–∞–Ω–Ω—ã–µ –∑–∞—â–∏—â–µ–Ω—ã –∏ –Ω–µ –ø–µ—Ä–µ–¥–∞—é—Ç—Å—è —Ç—Ä–µ—Ç—å–∏–º –ª–∏—Ü–∞–º.');
        }
        
        // –ü—Ä–æ–ø—É—Å—Ç–∏—Ç—å —Ñ–æ—Ä–º—É
        function skipForm() {
            window.location.href = '/';
        }
        
        // –û—Ç–ø—Ä–∞–≤–∫–∞ —Ñ–æ—Ä–º—ã
        async function submitInviteForm(event) {
            event.preventDefault();
            
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ cooldown
            const cooldown = checkCooldown();
            if (cooldown > 0) {
                showTimer(cooldown);
                return false;
            }
            
            const name = document.getElementById('inviteName').value.trim();
            const messenger = document.getElementById('inviteMessenger').value;
            const contact = document.getElementById('inviteContact').value.trim();
            const pushConsent = document.getElementById('invitePushConsent').checked;
            
            // –í–∞–ª–∏–¥–∞—Ü–∏—è
            if (!name) {
                showToast('–í–≤–µ–¥–∏—Ç–µ –≤–∞—à–µ –∏–º—è', 'error');
                return false;
            }
            
            if (!messenger) {
                showToast('–í—ã–±–µ—Ä–∏—Ç–µ –º–µ—Å—Å–µ–Ω–¥–∂–µ—Ä', 'error');
                return false;
            }
            
            const validation = validateContact(messenger, contact);
            if (!validation.valid) {
                document.getElementById('contactError').textContent = validation.error;
                document.getElementById('contactError').classList.add('show');
                showToast(validation.error, 'error');
                return false;
            }
            
            document.getElementById('contactError').classList.remove('show');
            
            // –û—Ç–∫–ª—é—á–∞–µ–º –∫–Ω–æ–ø–∫—É
            const btn = document.getElementById('submitBtn');
            btn.disabled = true;
            btn.textContent = '‚è≥ –û—Ç–ø—Ä–∞–≤–∫–∞...';
            
            try {
                // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –≤ Supabase
                const response = await fetch(`${SUPABASE_URL}/rest/v1/contacts`, {
                    method: 'POST',
                    headers: {
                        'apikey': SUPABASE_KEY,
                        'Authorization': `Bearer ${SUPABASE_KEY}`,
                        'Content-Type': 'application/json',
                        'Prefer': 'return=minimal'
                    },
                    body: JSON.stringify({
                        name: name,
                        messenger: messenger,
                        contact: validation.normalized,
                        push_consent: pushConsent,
                        source: 'Invite',
                        owner_gw_id: refId.startsWith('GW') ? refId : 'GW' + refId,
                        status: 'new',
                        created_at: new Date().toISOString()
                    })
                });
                
                if (response.ok || response.status === 201) {
                    console.log('‚úÖ Contact saved successfully');
                    
                    // –ó–∞–ø—É—Å–∫–∞–µ–º cooldown
                    startCooldown();
                    
                    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —É—Å–ø–µ—Ö
                    document.getElementById('formContainer').style.display = 'none';
                    document.getElementById('successContainer').style.display = 'block';
                    
                } else {
                    const errorData = await response.json();
                    
                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞ –¥—É–±–ª–∏–∫–∞—Ç
                    if (errorData.code === '23505' || errorData.message?.includes('duplicate')) {
                        showToast('‚ö†Ô∏è –≠—Ç–æ—Ç –∫–æ–Ω—Ç–∞–∫—Ç —É–∂–µ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω', 'error');
                    } else {
                        throw new Error(errorData.message || '–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è');
                    }
                }
                
            } catch (error) {
                console.error('‚ùå Error:', error);
                showToast('–û—à–∏–±–∫–∞: ' + error.message, 'error');
            }
            
            // –í–æ–∑–≤—Ä–∞—â–∞–µ–º –∫–Ω–æ–ø–∫—É
            btn.disabled = false;
            btn.textContent = 'üéÅ –ü—Ä–∏—Å–æ–µ–¥–∏–Ω–∏—Ç—å—Å—è';
            
            return false;
        }
        
        // –ü—Ä–æ–≤–µ—Ä–∫–∞ cooldown –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        window.onload = function() {
            const cooldown = checkCooldown();
            if (cooldown > 0) {
                // –ú–æ–∂–Ω–æ –ø–æ–∫–∞–∑–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ –∏–ª–∏ –ø—Ä–æ—Å—Ç–æ –ø–æ–¥–æ–∂–¥–∞—Ç—å
                console.log('‚è≥ Cooldown active:', cooldown, 'seconds');
            }
        };
    </script>
</body>
</html>
