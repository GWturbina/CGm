<!DOCTYPE html>
<html lang="en" id="htmlRoot">
<head>
    <meta http-equiv="Content-Security-Policy" 
        content="default-src 'self'; 
                 script-src 'self' 'unsafe-inline' 'unsafe-eval' https://cdn.jsdelivr.net https://unpkg.com; 
                 style-src 'self' 'unsafe-inline'; 
                 img-src 'self' data: blob: https:;
                 media-src 'self' data: blob: https:;
                 connect-src 'self' ws: wss: https:;
                 frame-src https://www.youtube.com https://embed.tiktok.com https://www.instagram.com;">
         
    <meta charset="UTF-8">

    <!-- PWA -->
    <link rel="manifest" href="/manifest.json">
    <meta name="theme-color" content="#FFD700">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="CardGift">
    <link rel="apple-touch-icon" href="/icons/icon-192.png">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title id="pageTitle">CardGift - Digital Card Generator</title>
    
    <!-- PWA Meta tags -->
    <meta name="description" content="–°–æ–∑–¥–∞–≤–∞–π—Ç–µ –ø–æ—Ç—Ä—è—Å–∞—é—â–∏–µ —Ü–∏—Ñ—Ä–æ–≤—ã–µ –æ—Ç–∫—Ä—ã—Ç–∫–∏ –∑–∞ —Å–µ–∫—É–Ω–¥—ã!">
    
    <!-- Favicon -->
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üéÅ</text></svg>">
    
    <!-- Open Graph -->
    <meta property="og:title" content="CardGift ‚Äì Digital Card Generator" id="ogTitle">
    <meta property="og:description" content="–°–æ–∑–¥–∞–≤–∞–π—Ç–µ –ø–æ—Ç—Ä—è—Å–∞—é—â–∏–µ —Ü–∏—Ñ—Ä–æ–≤—ã–µ –æ—Ç–∫—Ä—ã—Ç–∫–∏ –∑–∞ —Å–µ–∫—É–Ω–¥—ã!" id="ogDescription">
    <meta property="og:type" content="website">
    <meta property="og:site_name" content="CardGift">
    <meta name="twitter:card" content="summary_large_image">
    
    <!-- Styles -->
    <link rel="stylesheet" href="/css/common.css">
    <link rel="stylesheet" href="/css/generator.css">
    
    <!-- WEB3 Libraries -->
    <script src="https://cdn.jsdelivr.net/npm/web3@latest/dist/web3.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js"></script>
    
    <!-- Wallet (config –∏ bridge –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –≤ –∫–æ–Ω—Ü–µ body) -->
    <script src="/js/wallet-state.js?v=2"></script>
    <script src="/js/wallet.js?v=2"></script>
    <script src="/js/api.js?v=2"></script>
    <script src="/js/cardService.js?v=2"></script>
    
    <!-- Additional Libraries -->
    <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
</head>
<body>
    <!-- LANGUAGE SWITCHER -->
    <div class="language-switcher">
        <button class="lang-btn active" onclick="switchLanguage('en')" id="langEn">EN</button>
        <button class="lang-btn" onclick="switchLanguage('ru')" id="langRu">RU</button>
        <button class="lang-btn" onclick="switchLanguage('ua')" id="langUa">UA</button>
    </div>

    <div class="header">
        <div class="logo">CardGift</div>
        <div class="tagline" id="tagline">Create stunning digital cards in seconds!</div>

        <!-- USER PROFILE SECTION -->
        <div class="section">
            <div class="section-header">
                <span class="icon">üë§</span> <span id="yourProfile">Your Profile</span>
            </div>
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                <div>
                    <div style="color: #FFD700; font-weight: bold;">
                        ID: <span id="currentUserId">Connecting...</span>
                        <span id="userLevelBadge" class="user-level-badge user-level-0">GUEST</span>
                    </div>
                    <div id="userLevel" style="color: #CCC; font-size: 14px;">Guest User</div>
                    <div id="userCards" style="color: #888; font-size: 12px;">Cards: 0/5</div>
                </div>
                <div style="display: flex; gap: 8px;">
                    <button onclick="showInstructions()" class="btn btn-primary" style="padding: 8px 16px;">
                        <span id="instructionsBtn">üìã Instructions</span>
                    </button>
                    <button onclick="goToDashboard()" class="btn btn-blue" style="padding: 8px 16px;">
                        <span id="dashboardBtn">üìä Dashboard</span>
                    </button>
                </div>
            </div>
        </div>

        <!-- –ì–û–¢–û–í–´–ï –®–ê–ë–õ–û–ù–´ - –î–í–ï –ö–ù–û–ü–ö–ò -->
        <div class="section">
            <div class="section-header">
                <span class="icon">üìÇ</span> <span id="templatesAccess">–ì–æ—Ç–æ–≤—ã–µ —à–∞–±–ª–æ–Ω—ã</span>
            </div>
    
            <div style="display: flex; gap: 10px; margin-bottom: 12px;">
                <button onclick="openLeaderTemplates()" class="btn btn-primary" style="flex: 1; padding: 15px; font-size: 15px; background: linear-gradient(135deg, #667eea, #764ba2); border: none; border-radius: 12px; color: white; font-weight: bold; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 8px;">
                    <span style="font-size: 20px;">üëî</span>
                    <span>–û—Ç –ª–∏–¥–µ—Ä–∞</span>
                </button>
                <button onclick="openCorporateTemplates()" class="btn btn-primary" style="flex: 1; padding: 15px; font-size: 15px; background: linear-gradient(135deg, #f093fb, #f5576c); border: none; border-radius: 12px; color: white; font-weight: bold; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 8px;">
                    <span style="font-size: 20px;">üè¢</span>
                    <span>–ö–æ—Ä–ø–æ—Ä–∞—Ç–∏–≤–Ω—ã–µ</span>
                </button>
            </div>
            
            <div style="color: #888; font-size: 11px; text-align: center;">
                –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –≥–æ—Ç–æ–≤—ã–µ –æ—Ç–∫—Ä—ã—Ç–∫–∏ - —Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ –∏ —Å–æ—Ö—Ä–∞–Ω—è–π—Ç–µ —Å–æ –°–í–û–ï–ô —Å—Å—ã–ª–∫–æ–π!
            </div>
        </div>

        <!-- BLOCKCHAIN CONNECTION -->
        <div class="section">
            <div class="section-header">
                <span class="icon">üîó</span> <span id="blockchainConnection">Blockchain Connection</span>
            </div>
            <div id="walletSection">
                <button id="walletConnectBtn" onclick="connectWallet()" class="connect-wallet-btn">
                    <span id="connectSafePalWallet">üîó Connect SafePal Wallet</span>
                </button>
                <div id="walletStatus"></div>
                <div id="networkStatus" style="margin-top: 10px; font-size: 12px; text-align: center; color: #888;"></div>
            </div>
        </div>
    </div>

    <!-- INSTRUCTIONS MODAL -->
    <div id="instructionsModal" class="instructions-modal">
        <div class="instructions-content">
            <div class="instructions-header">üìã <span id="instructionsTitle">–†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ CardGift</span></div>
            
            <div class="instructions-body">
                <h3>üöÄ <span id="quickStartTitle">–ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç</span></h3>
                
                <div class="instruction-block">
                    <strong>1. üì∏ <span id="addPhotoTitle">–î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ñ–æ—Ç–æ</span></strong>
                    <ul class="instructions-list">
                        <li id="instruction1">–ù–∞–∂–º–∏—Ç–µ –Ω–∞ –æ–±–ª–∞—Å—Ç—å 'üì∏ –§–æ—Ç–æ'</li>
                        <li id="instruction2">–í—ã–±–µ—Ä–∏—Ç–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞</li>
                        <li id="instruction3"><em>–í–∞–∂–Ω–æ: –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω—ã–µ —Ñ–æ—Ç–æ –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö (–ø—Ä–æ–ø–æ—Ä—Ü–∏–∏ 9:16)</em></li>
                        <li id="instruction4"><em>–ò–∑–±–µ–≥–∞–π—Ç–µ: –ì–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω—ã–µ —Ñ–æ—Ç–æ ‚Äî –æ–Ω–∏ –ø–ª–æ—Ö–æ —Å–º–æ—Ç—Ä—è—Ç—Å—è –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö –æ—Ç–∫—Ä—ã—Ç–∫–∞—Ö</em></li>
                    </ul>
                </div>
                
                <div class="instruction-block">
                    <strong>2. ‚úçÔ∏è <span id="addTextTitle">–î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞</span></strong>
                    <ul class="instructions-list">
                        <li id="instruction5">–í–≤–µ–¥–∏—Ç–µ –ø–æ–∑–¥—Ä–∞–≤–ª–µ–Ω–∏–µ –≤ –ø–æ–ª–µ —Ç–µ–∫—Å—Ç–∞</li>
                        <li id="instruction6">–î–æ–±–∞–≤—å—Ç–µ –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ (–ø–æ—è–≤–ª—è–µ—Ç—Å—è –ø–æ —Ç–∞–π–º–µ—Ä—É)</li>
                        <li id="instruction7">–ú–æ–∂–µ—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —ç–º–æ–¥–∑–∏ üéâüíïüéÇ</li>
                    </ul>
                </div>
                
                <div class="instruction-block">
                    <strong>3. ‚è±Ô∏è <span id="timersTitle">–ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ç–∞–π–º–µ—Ä–æ–≤</span></strong>
                    <ul class="instructions-list">
                        <li id="instruction8">–¢–∞–π–º–µ—Ä –ª–∏—á–Ω–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è: –ö–æ–≥–¥–∞ –ø–æ—è–≤–ª—è–µ—Ç—Å—è –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–π —Ç–µ–∫—Å—Ç (1‚Äì30 —Å–µ–∫)</li>
                        <li id="instruction9">–¢–∞–π–º–µ—Ä –∫–Ω–æ–ø–∫–∏ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è: –ö–æ–≥–¥–∞ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –∫–Ω–æ–ø–∫–∞ '–ü–æ–ª—É—á–∏—Ç—å –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä' (1‚Äì60 —Å–µ–∫)</li>
                        <li id="instruction10">–¢–∞–π–º–µ—Ä –±–∞–Ω–Ω–µ—Ä–∞: –ö–æ–≥–¥–∞ –ø–æ—è–≤–ª—è–µ—Ç—Å—è —Ä–µ–∫–ª–∞–º–Ω—ã–π –±–∞–Ω–Ω–µ—Ä (–µ—Å–ª–∏ –≤–∫–ª—é—á–µ–Ω)</li>
                    </ul>
                </div>
                
                <div class="instruction-block">
                    <strong>4. üìç <span id="positionTitle">–ü–æ–∑–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–Ω–æ–ø–∫–∏</span></strong>
                    <ul class="instructions-list">
                        <li id="instruction11">–í—ã–±–µ—Ä–∏—Ç–µ –∏–∑ 9 –ø–æ–∑–∏—Ü–∏–π –¥–ª—è –∫–Ω–æ–ø–∫–∏ '–ü–æ–Ω—Ä–∞–≤–∏–ª–∞—Å—å –æ—Ç–∫—Ä—ã—Ç–∫–∞?'</li>
                        <li id="instruction12">–ò–∑–±–µ–≥–∞–π—Ç–µ –ø–æ–∑–∏—Ü–∏–π, –∫–æ—Ç–æ—Ä—ã–µ –∑–∞–∫—Ä—ã–≤–∞—é—Ç –≤–∞–∂–Ω—ã–π –∫–æ–Ω—Ç–µ–Ω—Ç</li>
                        <li id="instruction13">–ö–Ω–æ–ø–∫–∞ —Å–æ—Å—Ç–∞–≤–ª—è–µ—Ç 1/3 —à–∏—Ä–∏–Ω—ã —ç–∫—Ä–∞–Ω–∞ –¥–ª—è –∞–∫–∫—É—Ä–∞—Ç–Ω–æ–≥–æ –≤–∏–¥–∞</li>
                    </ul>
                </div>
                
                <div class="instruction-block">
                    <strong>5. üé® <span id="styleTitle">–í—ã–±–æ—Ä —Å—Ç–∏–ª—è</span></strong>
                    <ul class="instructions-list">
                        <li>‚ú® –ó–æ–ª–æ—Ç–æ (–∫–ª–∞—Å—Å–∏—á–µ—Å–∫–∏–π)</li>
                        <li>üåÖ –ó–∞–∫–∞—Ç (—Ä–æ–º–∞–Ω—Ç–∏—á–Ω—ã–π)</li>
                        <li>üåä –û–∫–µ–∞–Ω (—Å–≤–µ–∂–∏–π)</li>
                        <li>üåå –ö–æ—Å–º–æ—Å (—Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π)</li>
                    </ul>
                </div>
                
                <h3>üì¢ <span id="extraFeaturesTitle">–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏</span></h3>
                <ul class="instructions-list">
                    <li id="instruction14">üé® –î–µ–º–æ-—à–∞–±–ª–æ–Ω—ã: –ì–æ—Ç–æ–≤—ã–µ —Ç–µ–∫—Å—Ç—ã –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Å–ª—É—á–∞–µ–≤. –û—Ç–ª–∏—á–Ω–æ –ø–æ–¥—Ö–æ–¥—è—Ç –¥–ª—è –≤–¥–æ—Ö–Ω–æ–≤–µ–Ω–∏—è.</li>
                    <li id="instruction15">üì¢ –†–µ–∫–ª–∞–º–Ω—ã–π –±–∞–Ω–Ω–µ—Ä: –î–æ–±–∞–≤—å—Ç–µ HTML-–∫–æ–¥ –¥–ª—è —Å–≤–æ–µ–≥–æ –±–∞–Ω–Ω–µ—Ä–∞. –ò–¥–µ–∞–ª—å–Ω–æ –¥–ª—è —Ä–µ–∫–ª–∞–º—ã –±–∏–∑–Ω–µ—Å–∞ –∏–ª–∏ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–π.</li>
                    <li id="instruction16">üîó –†–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞: –í–∞—à —É–Ω–∏–∫–∞–ª—å–Ω—ã–π 7-–∑–Ω–∞—á–Ω—ã–π ID. –î–µ–ª–∏—Ç–µ—Å—å —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω–æ–π —Å—Å—ã–ª–∫–æ–π.</li>
                </ul>
                
                <h3>üéØ <span id="mobileOptTitle">–°–æ–≤–µ—Ç—ã –¥–ª—è –º–æ–±–∏–ª—å–Ω–æ–π –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏</span></h3>
                <div id="photoFormatsTitle"><strong>–õ—É—á—à–∏–µ —Ñ–æ—Ä–º–∞—Ç—ã —Ñ–æ—Ç–æ:</strong></div>
                <ul class="instructions-list">
                    <li id="instruction17">–í–µ—Ä—Ç–∏–∫–∞–ª—å–Ω—ã–µ —Ñ–æ—Ç–æ ‚Üí –∏–¥–µ–∞–ª—å–Ω—ã –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö –æ—Ç–∫—Ä—ã—Ç–æ–∫</li>
                    <li id="instruction18">–ö–≤–∞–¥—Ä–∞—Ç–Ω—ã–µ —Ñ–æ—Ç–æ ‚Üí –ø–æ–∫–∞–∂—É—Ç—Å—è —Å —Ñ–æ–Ω–æ–º</li>
                    <li id="instruction19">–ò–∑–±–µ–≥–∞–π—Ç–µ –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω—ã—Ö ‚Üí –ø–ª–æ—Ö–æ —Ä–∞–±–æ—Ç–∞—é—Ç –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö</li>
                </ul>
                
                <div class="instruction-important">
                    üì± <span id="mainRule">–ì–ª–∞–≤–Ω–æ–µ –ø—Ä–∞–≤–∏–ª–æ: –í—Å–µ–≥–¥–∞ –¥—É–º–∞–π—Ç–µ –æ –º–æ–±–∏–ª—å–Ω—ã—Ö! –í–∞—à–∏ –æ—Ç–∫—Ä—ã—Ç–∫–∏ –±—É–¥—É—Ç –ø—Ä–æ—Å–º–∞—Ç—Ä–∏–≤–∞—Ç—å –Ω–∞ —Ç–µ–ª–µ—Ñ–æ–Ω–∞—Ö.</span> ‚ú®
                </div>
                
                <h3>üöÄ <span id="viralMarketingTitle">Viral Marketing - Ready Templates</span></h3>
                
                <div class="instruction-block" style="background: rgba(255, 215, 0, 0.1); padding: 15px; border-radius: 10px; border-left: 4px solid #FFD700; margin-bottom: 20px;">
                    <strong style="color: #FFD700;">üìÇ Use ready-made cards!</strong>
                    <p style="margin: 10px 0 0 0; color: #CCC; line-height: 1.6;">
                        No need to create cards from scratch! Use ready templates marked by team members or corporate cards.
                    </p>
                </div>
                
                <div class="instruction-block">
                    <strong>üìÇ How to use ready templates:</strong>
                    <ul class="instructions-list">
                        <li><strong>Open templates:</strong> Click "üìÇ Open Ready Templates" button at the top</li>
                        <li><strong>Choose card:</strong> Browse templates with badges:
                            <ul style="margin-top: 5px;">
                                <li>üìã <strong>TEMPLATE</strong> - Regular team templates</li>
                                <li>üè¢ <strong>CORPORATE</strong> - Official company templates</li>
                            </ul>
                        </li>
                        <li><strong>Click to load:</strong> Card loads into generator with all settings</li>
                        <li><strong>Edit if needed:</strong> Change text, photo, or keep as is</li>
                        <li><strong>Save:</strong> YOUR referral link is automatically inserted! üéØ</li>
                        <li><strong>Share:</strong> Send to friends - they get YOUR link!</li>
                    </ul>
                </div>
                
                <div class="instruction-block" style="background: linear-gradient(135deg, rgba(76, 175, 80, 0.2) 0%, rgba(76, 175, 80, 0.05) 100%); padding: 15px; border-radius: 10px; border: 2px solid #4CAF50;">
                    <strong style="color: #4CAF50; font-size: 16px;">üéØ How viral marketing works:</strong>
                    <ol style="margin: 10px 0 0 20px; color: #CCC; line-height: 1.8;">
                        <li>Take a ready template (from team or corporate)</li>
                        <li>Edit to your needs (or keep as is)</li>
                        <li>Save ‚Üí YOUR referral link is auto-inserted</li>
                        <li>Send to friends/clients via messengers</li>
                        <li>They receive beautiful card with YOUR link!</li>
                        <li>They click ‚Üí Register via YOUR link</li>
                        <li>You get referrals ‚Üí They take your cards too</li>
                        <li><strong style="color: #FFD700;">Chain grows exponentially! üöÄ</strong></li>
                    </ol>
                </div>
                
                <div class="instruction-important" style="background: linear-gradient(135deg, rgba(255, 215, 0, 0.2) 0%, rgba(255, 152, 0, 0.1) 100%); border-color: #FFD700;">
                    üí° <strong>Tip:</strong> Beginners should use ready templates! They are tested and work well. Create your own later. ‚ú®
                </div>
            </div>
            
            <button class="close-instructions" onclick="hideInstructions()" id="closeInstructionsBtn">Close</button>
        </div>
    </div>

    <!-- MEDIA UPLOAD -->
    <div class="section">
        <div class="section-header">
            <span class="icon">üì∑</span> <span id="media">Photo/Video</span>
        </div>

        <label for="mediaUpload" class="media-upload">
            <div class="media-upload-icon">üì∑</div>
            <div class="media-upload-text" id="uploadMedia">Click to upload photo or video</div>
            <div class="media-upload-subtext" id="uploadRecommendation">Recommended: vertical format (9:16)</div>
            <input type="file" id="mediaUpload" style="display: none;" accept="image/*,video/*" onchange="handleMediaUpload(event)">
        </label>

        <div id="mediaPreview"></div>

        <div id="orInsertVideo" style="margin-top: 15px; color: #CCC; font-weight: bold;">Or insert video URL:</div>
        <input type="text" id="videoUrl" class="input-field" placeholder="YouTube, TikTok, Instagram Reels URL..." oninput="onVideoUrlChange()">

        <!-- –ó–∞–≥—Ä—É–∑–∫–∞ –æ–±–ª–æ–∂–∫–∏ –≤–∏–¥–µ–æ -->
        <div id="videoThumbnailSection" style="display: none; margin-top: 15px; padding: 15px; background: rgba(255,215,0,0.1); border: 1px dashed #FFD700; border-radius: 10px;">
            <div style="color: #FFD700; font-weight: bold; margin-bottom: 10px;">
                üñºÔ∏è <span id="thumbnailLabel">–û–±–ª–æ–∂–∫–∞ –≤–∏–¥–µ–æ (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)</span>
            </div>
            <div style="color: #AAA; font-size: 12px; margin-bottom: 10px;" id="thumbnailHint">
                –ó–∞–≥—Ä—É–∑–∏—Ç–µ —Å–≤–æ—é –∫–∞—Ä—Ç–∏–Ω–∫—É –¥–ª—è –ø—Ä–µ–≤—å—é –≤ –º–µ—Å—Å–µ–Ω–¥–∂–µ—Ä–∞—Ö. –ï—Å–ª–∏ –Ω–µ –∑–∞–≥—Ä—É–∑–∏—Ç–µ ‚Äî –±—É–¥–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ–±–ª–æ–∂–∫–∞ –∏–∑ –≤–∏–¥–µ–æ.
            </div>
            <label class="media-upload-area" style="min-height: 80px; cursor: pointer;" for="thumbnailUpload">
                <div id="thumbnailPreview" style="display: none;"></div>
                <div id="thumbnailPlaceholder">
                    <div style="font-size: 24px;">üì∑</div>
                    <div style="color: #CCC; font-size: 13px;">–ù–∞–∂–º–∏—Ç–µ –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –æ–±–ª–æ–∂–∫–∏</div>
                    <div style="color: #888; font-size: 11px;">–†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–π —Ä–∞–∑–º–µ—Ä: 1200√ó630 px</div>
                </div>
                <input type="file" id="thumbnailUpload" style="display: none;" accept="image/*" onchange="handleThumbnailUpload(event)">
            </label>
            <button id="removeThumbnailBtn" style="display: none; margin-top: 10px; background: #ff4444; color: white; border: none; padding: 8px 16px; border-radius: 20px; cursor: pointer; font-size: 12px;" onclick="removeThumbnail()">
                ‚úï –£–¥–∞–ª–∏—Ç—å –æ–±–ª–æ–∂–∫—É
            </button>
        </div>

        <div style="display: flex; gap: 10px; margin-top: 10px; justify-content: center; flex-wrap: wrap;">
            <span style="background: #FF0000; color: white; padding: 4px 8px; border-radius: 12px; font-size: 11px; font-weight: bold;">üì∫ YouTube</span>
            <span style="background: #FF0050; color: white; padding: 4px 8px; border-radius: 12px; font-size: 11px; font-weight: bold;">üéµ TikTok</span>
            <span style="background: #E4405F; color: white; padding: 4px 8px; border-radius: 12px; font-size: 11px; font-weight: bold;">üì∑ Instagram</span>
        </div>
    </div>

    <!-- TEXT EDITOR -->
    <div class="section" id="text" style="display: block !important; visibility: visible !important;">
        <div class="section-header">
            <span class="icon">‚úèÔ∏è</span> <span id="textLabel">–¢–µ–∫—Å—Ç</span>
        </div>

        <div class="text-editor" style="display: flex !important; flex-direction: column !important; gap: 15px !important;">
            <textarea id="greetingText" placeholder="–í–≤–µ–¥–∏—Ç–µ –≤–∞—à–µ –ø–æ–∑–¥—Ä–∞–≤–ª–µ–Ω–∏–µ –∑–¥–µ—Å—å..." class="input-field" style="display: block !important; width: 100% !important; min-height: 120px !important; background-color: #333 !important; border: 2px solid #FFD700 !important; color: #FFF !important; padding: 15px !important; border-radius: 10px !important; font-size: 16px !important; box-sizing: border-box !important;"></textarea>

            <div class="text-controls" style="display: flex !important; flex-wrap: wrap !important; gap: 15px !important; margin-top: 10px !important;">
                <button class="emoji-btn" onclick="toggleEmojiPicker()" style="background: linear-gradient(45deg, #FFD700, #FFA500) !important; color: #000 !important; border: none !important; border-radius: 30px !important; padding: 12px 20px !important; font-weight: bold !important; cursor: pointer !important;">
                    üòä –î–æ–±–∞–≤–∏—Ç—å —ç–º–æ–¥–∑–∏
                </button>
                
                <div class="text-position">
                    <span>üìç <span id="textPosition">Text Position</span></span>
                    <div class="position-grid">
                        <button class="position-btn" data-position="topLeft" onclick="setTextPosition('topLeft')">‚Üñ</button>
                        <button class="position-btn" data-position="top" onclick="setTextPosition('top')">‚Üë</button>
                        <button class="position-btn" data-position="topRight" onclick="setTextPosition('topRight')">‚Üó</button>
                        <button class="position-btn" data-position="left" onclick="setTextPosition('left')">‚Üê</button>
                        <button class="position-btn" data-position="center" onclick="setTextPosition('center')">‚Ä¢</button>
                        <button class="position-btn" data-position="right" onclick="setTextPosition('right')">‚Üí</button>
                        <button class="position-btn" data-position="bottomLeft" onclick="setTextPosition('bottomLeft')">‚Üô</button>
                        <button class="position-btn active" data-position="bottom" onclick="setTextPosition('bottom')">‚Üì</button>
                        <button class="position-btn" data-position="bottomRight" onclick="setTextPosition('bottomRight')">‚Üò</button>
                    </div>
                </div>
            </div>

            <div id="emojiPicker" class="emoji-picker">
                <div class="emoji-categories">
                    <button data-category="smileys" class="active" onclick="loadEmojis('smileys')">üòä</button>
                    <button data-category="animals" onclick="loadEmojis('animals')">üê∂</button>
                    <button data-category="food" onclick="loadEmojis('food')">üçî</button>
                    <button data-category="travel" onclick="loadEmojis('travel')">‚úàÔ∏è</button>
                    <button data-category="activities" onclick="loadEmojis('activities')">‚öΩ</button>
                    <button data-category="objects" onclick="loadEmojis('objects')">üí°</button>
                    <button data-category="symbols" onclick="loadEmojis('symbols')">‚ù§Ô∏è</button>
                    <button data-category="flags" onclick="loadEmojis('flags')">üèÅ</button>
                </div>
                <div class="emoji-container"></div>
            </div>
        </div>

        <div class="template-options">
            <div id="useTemplate">Use template:</div>
            <button class="template-btn" onclick="useTemplate('birthday')">üéÇ <span id="birthday">Birthday</span></button>
            <button class="template-btn" onclick="useTemplate('newyear')">üéÑ <span id="newyear">New Year</span></button>
            <button class="template-btn" onclick="useTemplate('love')">üíï <span id="love">Love</span></button>
            <button class="template-btn" onclick="useTemplate('thanks')">üôè <span id="thanks">Thanks</span></button>
            <button class="template-btn" onclick="useTemplate('congrats')">üéâ <span id="congrats">Congrats</span></button>
        </div>

        <div style="margin-top: 15px;">
            <button onclick="showInstructions()" class="btn btn-blue" style="margin-right: 10px;">
                üìã <span id="instructions">Instructions</span>
            </button>
            <button onclick="showPreview()" style="background: linear-gradient(45deg, #9C27B0, #7B1FA2); color: white; border: none; border-radius: 8px; padding: 10px 20px; cursor: pointer;">
                üëÅÔ∏è <span id="preview">Preview</span>
            </button>
        </div>
    </div>

    <!-- STYLE SELECTION -->
    <div class="section">
        <div class="section-header">
            <span class="icon">üé®</span> <span id="style">Style</span>
        </div>

        <div class="style-options">
            <div class="style-option active" data-style="classic" onclick="selectStyle('classic')">
                <div class="style-icon">‚ú®</div>
                <div class="style-name" id="classic">Classic</div>
            </div>
            <div class="style-option" data-style="sunset" onclick="selectStyle('sunset')">
                <div class="style-icon">üåÖ</div>
                <div class="style-name" id="sunset">Sunset</div>
            </div>
            <div class="style-option" data-style="ocean" onclick="selectStyle('ocean')">
                <div class="style-icon">üåä</div>
                <div class="style-name" id="ocean">Ocean</div>
            </div>
            <div class="style-option" data-style="space" onclick="selectStyle('space')">
                <div class="style-icon">üåå</div>
                <div class="style-name" id="space">Space</div>
            </div>
            <div class="style-option" data-style="neon" onclick="selectStyle('neon')">
                <div class="style-icon">üí´</div>
                <div class="style-name" id="neon">Neon</div>
            </div>
        </div>
    </div>

    <!-- ADVANCED SETTINGS -->
    <div class="section">
        <div class="section-header">
            <span class="icon">‚öôÔ∏è</span> <span id="advancedSettings">Advanced Settings</span>
        </div>

        <div class="toggle-row">
            <div class="toggle-label" id="callToAction">Call to Action</div>
            <input type="checkbox" id="ctaToggle" checked onchange="toggleCTA()">
        </div>

        <div id="ctaSettings">
            <input type="text" id="ctaTitle" class="input-field" placeholder="Like this card?">
            <input type="text" id="ctaButton" class="input-field" placeholder="Get Card Generator">
            <input type="text" id="ctaUrl" class="input-field" placeholder="URL">

            <div class="text-position">
                <span id="buttonPosition">Button Position:</span>
                <div class="position-grid">
                    <button class="position-btn" data-position="topLeft" onclick="setCTAPosition('topLeft')">‚Üñ</button>
                    <button class="position-btn" data-position="top" onclick="setCTAPosition('top')">‚Üë</button>
                    <button class="position-btn" data-position="topRight" onclick="setCTAPosition('topRight')">‚Üó</button>
                    <button class="position-btn" data-position="left" onclick="setCTAPosition('left')">‚Üê</button>
                    <button class="position-btn" data-position="center" onclick="setCTAPosition('center')">‚Ä¢</button>
                    <button class="position-btn" data-position="right" onclick="setCTAPosition('right')">‚Üí</button>
                    <button class="position-btn" data-position="bottomLeft" onclick="setCTAPosition('bottomLeft')">‚Üô</button>
                    <button class="position-btn active" data-position="bottom" onclick="setCTAPosition('bottom')">‚Üì</button>
                    <button class="position-btn" data-position="bottomRight" onclick="setCTAPosition('bottomRight')">‚Üò</button>
                </div>
            </div>
            
            <div class="timer-input">
                <div class="timer-label" id="messageTimer">Message show delay:</div>
                <input type="number" id="messageTimerInput" class="timer-field" value="0" min="0" max="10">
                <div class="timer-suffix" id="seconds">seconds</div>
            </div>
            
            <div class="timer-input">
                <div class="timer-label" id="buttonTimer">Button show delay:</div>
                <input type="number" id="buttonTimerInput" class="timer-field" value="3" min="0" max="10">
                <div class="timer-suffix">seconds</div>
            </div>
        </div>

        <div class="toggle-row">
            <div class="toggle-label" id="marqueeText">Running Text</div>
            <input type="checkbox" id="marqueeToggle" onchange="toggleMarquee()">
        </div>

        <div id="marqueeSettings" style="display: none;">
            <input type="text" id="marqueeTextInput" class="input-field" placeholder="Your running text...">
            <input type="text" id="marqueeUrl" class="input-field" placeholder="URL">
            
            <div class="timer-input">
                <div class="timer-label" id="marqueeTimer">Show running text after:</div>
                <input type="number" id="marqueeTimerInput" class="timer-field" value="7" min="0" max="15">
                <div class="timer-suffix">seconds</div>
            </div>
        </div>

        <div class="toggle-row">
            <div class="toggle-label" id="banner">Banner</div>
            <input type="checkbox" id="bannerToggle" onchange="toggleBanner()">
        </div>

        <div id="bannerSettings" style="display: none;">
            <textarea id="bannerHtml" class="input-field" placeholder="<div>Your HTML Banner Code</div>"></textarea>
            <input type="text" id="bannerUrl" class="input-field" placeholder="URL">
            
            <div class="timer-input">
                <div class="timer-label" id="bannerTimer">Show the banner after:</div>
                <input type="number" id="bannerTimerInput" class="timer-field" value="5" min="0" max="10">
                <div class="timer-suffix">seconds</div>
            </div>
        </div>
    </div>

    <!-- =====================================================
     BONUS OFFER SECTION –¥–ª—è generator.html
     –î–æ–±–∞–≤–∏—Ç—å –ø–æ—Å–ª–µ —Å–µ–∫—Ü–∏–∏ BANNER –∏–ª–∏ –ø–µ—Ä–µ–¥ –∫–Ω–æ–ø–∫–æ–π CREATE CARD
     ===================================================== -->

<!-- BONUS OFFER / VIRAL MECHANICS -->
<div class="section" id="bonusOfferSection">
    <div class="section-header">
        <span class="icon">üéÅ</span> <span id="bonusOfferTitle">–ë–æ–Ω—É—Å–Ω–æ–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ (–≤–∏—Ä—É—Å–Ω—ã–π –º–∞—Ä–∫–µ—Ç–∏–Ω–≥)</span>
    </div>
    
    <div style="background: rgba(255,215,0,0.1); border: 1px solid rgba(255,215,0,0.3); border-radius: 12px; padding: 15px; margin-bottom: 20px;">
        <div style="color: #FFD700; font-size: 14px; margin-bottom: 10px;">
            üí° <strong>–ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç:</strong>
        </div>
        <div style="color: #CCC; font-size: 13px; line-height: 1.6;">
            –ö–æ–≥–¥–∞ –ø–æ–ª—É—á–∞—Ç–µ–ª—å –ø–æ–ø—ã—Ç–∞–µ—Ç—Å—è –∑–∞–∫—Ä—ã—Ç—å –æ—Ç–∫—Ä—ã—Ç–∫—É ‚Äî –ø–æ—è–≤–∏—Ç—Å—è popup —Å –≤–∞—à–∏–º –±–æ–Ω—É—Å–Ω—ã–º –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ–º.
            –ß—Ç–æ–±—ã –ø–æ–ª—É—á–∏—Ç—å –±–æ–Ω—É—Å, –µ–º—É –Ω—É–∂–Ω–æ –ø–æ–¥–µ–ª–∏—Ç—å—Å—è –æ—Ç–∫—Ä—ã—Ç–∫–æ–π —Å –¥—Ä—É–∑—å—è–º–∏ –∏ –æ—Å—Ç–∞–≤–∏—Ç—å –∫–æ–Ω—Ç–∞–∫—Ç.
            –í—ã –ø–æ–ª—É—á–∏—Ç–µ –Ω–æ–≤—ã—Ö –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã—Ö –∫–ª–∏–µ–Ω—Ç–æ–≤! üöÄ
        </div>
    </div>
    
    <!-- –í–∫–ª—é—á–∏—Ç—å/–≤—ã–∫–ª—é—á–∏—Ç—å -->
    <label class="toggle-container" style="display: flex; align-items: center; gap: 12px; cursor: pointer; margin-bottom: 20px;">
        <input type="checkbox" id="bonusEnabled" style="width: 20px; height: 20px; accent-color: #FFD700;">
        <span style="color: #FFF; font-size: 15px;">–í–∫–ª—é—á–∏—Ç—å exit-popup —Å –ø–æ–¥–∞—Ä–∫–æ–º</span>
    </label>
    
    <!-- –ö–æ–Ω—Ç–µ–Ω—Ç –±–æ–Ω—É—Å–∞ (—Å–∫—Ä—ã—Ç –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é) -->
    <div id="bonusOfferContent" style="display: none;">
        
        <!-- –í—ã–±–æ—Ä —Ç–∏–ø–∞: –∫–∞—Ä—Ç–∏–Ω–∫–∞ –∏–ª–∏ —Ç–µ–∫—Å—Ç -->
        <div style="margin-bottom: 20px;">
            <div style="color: #CCC; margin-bottom: 10px;">–¢–∏–ø popup:</div>
            <div style="display: flex; gap: 10px;">
                <button type="button" class="bonus-type-btn active" data-type="image" onclick="setBonusType('image')" style="flex: 1; padding: 12px; border-radius: 10px; border: 2px solid #FFD700; background: rgba(255,215,0,0.2); color: #FFD700; cursor: pointer; font-weight: bold;">
                    üñºÔ∏è –ö–∞—Ä—Ç–∏–Ω–∫–∞
                </button>
                <button type="button" class="bonus-type-btn" data-type="text" onclick="setBonusType('text')" style="flex: 1; padding: 12px; border-radius: 10px; border: 2px solid #444; background: transparent; color: #888; cursor: pointer; font-weight: bold;">
                    ‚úèÔ∏è –¢–µ–∫—Å—Ç
                </button>
            </div>
        </div>
        
        <!-- –ó–∞–≥—Ä—É–∑–∫–∞ –∫–∞—Ä—Ç–∏–Ω–∫–∏ -->
        <div id="bonusImageSection" style="margin-bottom: 20px;">
            <div style="color: #FFD700; font-weight: bold; margin-bottom: 10px;">
                üñºÔ∏è –ö–∞—Ä—Ç–∏–Ω–∫–∞ –¥–ª—è popup (–∫–≤–∞–¥—Ä–∞—Ç–Ω–∞—è)
            </div>
            <div style="color: #AAA; font-size: 12px; margin-bottom: 10px;">
                –ó–∞–≥—Ä—É–∑–∏—Ç–µ –≥–æ—Ç–æ–≤—É—é –∫–∞—Ä—Ç–∏–Ω–∫—É —Å —Ç–µ–∫—Å—Ç–æ–º –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è –∏–ª–∏ —Å–≥–µ–Ω–µ—Ä–∏—Ä—É–π—Ç–µ –≤ AI Studio.
                –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–π —Ä–∞–∑–º–µ—Ä: 800√ó800 px
            </div>
            <label class="media-upload-area" style="min-height: 150px; cursor: pointer; display: flex; flex-direction: column; align-items: center; justify-content: center; border: 2px dashed #FFD700; border-radius: 15px; background: rgba(255,215,0,0.05);" for="bonusImageUpload">
                <div id="bonusImagePreview" style="display: none; width: 100%; max-width: 300px;">
                    <img id="bonusImagePreviewImg" style="width: 100%; border-radius: 10px;">
                </div>
                <div id="bonusImagePlaceholder">
                    <div style="font-size: 48px; margin-bottom: 10px;">üéÅ</div>
                    <div style="color: #FFD700; font-size: 14px;">–ù–∞–∂–º–∏—Ç–µ –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏</div>
                    <div style="color: #888; font-size: 12px; margin-top: 5px;">–∏–ª–∏ –ø–µ—Ä–µ—Ç–∞—â–∏—Ç–µ —Ñ–∞–π–ª —Å—é–¥–∞</div>
                </div>
                <input type="file" id="bonusImageUpload" style="display: none;" accept="image/*" onchange="handleBonusImageUpload(event)">
            </label>
            <div style="display: flex; gap: 10px; margin-top: 10px;">
                <button type="button" id="removeBonusImageBtn" style="display: none; flex: 1; background: #ff4444; color: white; border: none; padding: 10px; border-radius: 20px; cursor: pointer; font-size: 13px;" onclick="removeBonusImage()">
                    ‚úï –£–¥–∞–ª–∏—Ç—å –∫–∞—Ä—Ç–∏–Ω–∫—É
                </button>
                <button type="button" style="flex: 1; background: linear-gradient(45deg, #9C27B0, #7B1FA2); color: white; border: none; padding: 10px; border-radius: 20px; cursor: pointer; font-size: 13px;" onclick="window.open('/ai-studio.html', '_blank')">
                    ü§ñ –°–æ–∑–¥–∞—Ç—å –≤ AI Studio
                </button>
            </div>
        </div>
        
        <!-- –¢–µ–∫—Å—Ç–æ–≤—ã–π popup (–∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞ –∫–∞—Ä—Ç–∏–Ω–∫–µ) -->
        <div id="bonusTextSection" style="display: none; margin-bottom: 20px;">
            <div style="color: #FFD700; font-weight: bold; margin-bottom: 10px;">
                ‚úèÔ∏è –¢–µ–∫—Å—Ç popup
            </div>
            <input type="text" id="bonusTitle" class="input-field" placeholder="–ó–∞–≥–æ–ª–æ–≤–æ–∫: –ù–µ —Å–ø–µ—à–∏ –∑–∞–∫—Ä—ã–≤–∞—Ç—å! üéÅ" style="margin-bottom: 10px;">
            <textarea id="bonusText" class="input-field" placeholder="–¢–µ–∫—Å—Ç –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è: –£ –º–µ–Ω—è –¥–ª—è —Ç–µ–±—è –ø–æ–¥–∞—Ä–æ–∫! –ü–æ–ª—É—á–∏ —Å–∫–∏–¥–∫—É 10%..." style="min-height: 80px;"></textarea>
        </div>
        
        <!-- –¢–µ–∫—Å—Ç –∫–Ω–æ–ø–∫–∏ -->
        <div style="margin-bottom: 20px;">
            <div style="color: #CCC; margin-bottom: 8px;">–¢–µ–∫—Å—Ç –∫–Ω–æ–ø–∫–∏ "–ü–æ–ª—É—á–∏—Ç—å":</div>
            <input type="text" id="bonusButtonText" class="input-field" placeholder="–ü–æ–ª—É—á–∏—Ç—å –ø–æ–¥–∞—Ä–æ–∫" value="üéÅ –ü–æ–ª—É—á–∏—Ç—å –ø–æ–¥–∞—Ä–æ–∫">
        </div>
        
        <!-- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥—Ä—É–∑–µ–π –¥–ª—è —à–µ—Ä–∏–Ω–≥–∞ -->
        <div style="margin-bottom: 20px;">
            <div style="color: #CCC; margin-bottom: 8px;">–°–∫–æ–ª—å–∫–æ –¥—Ä—É–∑–µ–π –Ω—É–∂–Ω–æ –ø—Ä–∏–≥–ª–∞—Å–∏—Ç—å:</div>
            <div style="display: flex; align-items: center; gap: 15px;">
                <input type="range" id="bonusRequiredSlider" min="1" max="10" value="5" style="flex: 1; accent-color: #FFD700;" oninput="updateBonusRequiredDisplay()">
                <span id="bonusRequiredDisplay" style="color: #FFD700; font-size: 24px; font-weight: bold; min-width: 40px; text-align: center;">5</span>
            </div>
            <div style="color: #888; font-size: 12px; margin-top: 5px;">
                –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º 3-5 –¥–ª—è –ª—É—á—à–µ–π –∫–æ–Ω–≤–µ—Ä—Å–∏–∏
            </div>
        </div>
        
        <!-- –°—Å—ã–ª–∫–∞ –¥–ª—è —Å–≤—è–∑–∏ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) -->
        <div style="margin-bottom: 20px;">
            <div style="color: #CCC; margin-bottom: 8px;">–°—Å—ã–ª–∫–∞ –¥–ª—è —Å–≤—è–∑–∏ —Å –≤–∞–º–∏ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ):</div>
            <input type="text" id="bonusContactLink" class="input-field" placeholder="https://t.me/your_username">
            <div style="color: #888; font-size: 12px; margin-top: 5px;">
                Telegram, WhatsApp, –∏–ª–∏ –ª—é–±–∞—è –¥—Ä—É–≥–∞—è —Å—Å—ã–ª–∫–∞. –ü–æ—è–≤–∏—Ç—Å—è –∫–Ω–æ–ø–∫–∞ "–ù–∞–ø–∏—Å–∞—Ç—å" –≤ –ø—Ä–æ—â–∞–ª—å–Ω–æ–º popup.
            </div>
        </div>
        
        <!-- –ü—Ä–µ–≤—å—é -->
        <div style="margin-top: 20px;">
            <button type="button" onclick="previewBonusPopup()" style="width: 100%; background: linear-gradient(45deg, #FF9800, #FF5722); color: white; border: none; padding: 14px; border-radius: 25px; cursor: pointer; font-size: 15px; font-weight: bold;">
                üëÅÔ∏è –ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä popup
            </button>
        </div>
        
    </div>
</div>

<script>
// ===== BONUS OFFER LOGIC =====

let bonusImageData = null;
let bonusType = 'image';

// –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –≤–∫–ª—é—á–µ–Ω–∏—è –±–æ–Ω—É—Å–∞
document.getElementById('bonusEnabled')?.addEventListener('change', function() {
    const content = document.getElementById('bonusOfferContent');
    if (content) {
        content.style.display = this.checked ? 'block' : 'none';
    }
});

// –í—ã–±–æ—Ä —Ç–∏–ø–∞ popup
function setBonusType(type) {
    bonusType = type;
    
    // –û–±–Ω–æ–≤–ª—è–µ–º –∫–Ω–æ–ø–∫–∏
    document.querySelectorAll('.bonus-type-btn').forEach(btn => {
        if (btn.dataset.type === type) {
            btn.style.border = '2px solid #FFD700';
            btn.style.background = 'rgba(255,215,0,0.2)';
            btn.style.color = '#FFD700';
            btn.classList.add('active');
        } else {
            btn.style.border = '2px solid #444';
            btn.style.background = 'transparent';
            btn.style.color = '#888';
            btn.classList.remove('active');
        }
    });
    
    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º/—Å–∫—Ä—ã–≤–∞–µ–º —Å–µ–∫—Ü–∏–∏
    document.getElementById('bonusImageSection').style.display = type === 'image' ? 'block' : 'none';
    document.getElementById('bonusTextSection').style.display = type === 'text' ? 'block' : 'none';
}

// –ó–∞–≥—Ä—É–∑–∫–∞ –∫–∞—Ä—Ç–∏–Ω–∫–∏ –±–æ–Ω—É—Å–∞
function handleBonusImageUpload(event) {
    const file = event.target.files[0];
    if (!file) return;
    
    const reader = new FileReader();
    reader.onload = function(e) {
        bonusImageData = e.target.result;
        
        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø—Ä–µ–≤—å—é
        const preview = document.getElementById('bonusImagePreview');
        const previewImg = document.getElementById('bonusImagePreviewImg');
        const placeholder = document.getElementById('bonusImagePlaceholder');
        const removeBtn = document.getElementById('removeBonusImageBtn');
        
        previewImg.src = bonusImageData;
        preview.style.display = 'block';
        placeholder.style.display = 'none';
        removeBtn.style.display = 'block';
        
        console.log('üñºÔ∏è Bonus image loaded');
    };
    reader.readAsDataURL(file);
}

// –£–¥–∞–ª–µ–Ω–∏–µ –∫–∞—Ä—Ç–∏–Ω–∫–∏ –±–æ–Ω—É—Å–∞
function removeBonusImage() {
    bonusImageData = null;
    document.getElementById('bonusImageUpload').value = '';
    document.getElementById('bonusImagePreview').style.display = 'none';
    document.getElementById('bonusImagePlaceholder').style.display = 'flex';
    document.getElementById('removeBonusImageBtn').style.display = 'none';
}

// –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –¥—Ä—É–∑–µ–π
function updateBonusRequiredDisplay() {
    const slider = document.getElementById('bonusRequiredSlider');
    const display = document.getElementById('bonusRequiredDisplay');
    if (slider && display) {
        display.textContent = slider.value;
    }
}

// –ü–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –±–æ–Ω—É—Å–∞ –¥–ª—è cardData
function getBonusOfferData() {
    const enabled = document.getElementById('bonusEnabled')?.checked || false;
    
    if (!enabled) {
        return { bonusEnabled: false };
    }
    
    return {
        bonusEnabled: true,
        bonusType: bonusType,
        bonusImage: bonusType === 'image' ? bonusImageData : null,
        bonusTitle: document.getElementById('bonusTitle')?.value || 'üéÅ –ù–µ —Å–ø–µ—à–∏ –∑–∞–∫—Ä—ã–≤–∞—Ç—å!',
        bonusText: document.getElementById('bonusText')?.value || '–£ –º–µ–Ω—è –¥–ª—è —Ç–µ–±—è –ø–æ–¥–∞—Ä–æ–∫!',
        bonusButtonText: document.getElementById('bonusButtonText')?.value || 'üéÅ –ü–æ–ª—É—á–∏—Ç—å –ø–æ–¥–∞—Ä–æ–∫',
        bonusRequired: parseInt(document.getElementById('bonusRequiredSlider')?.value) || 5,
        bonusContactLink: document.getElementById('bonusContactLink')?.value || null
    };
}

// –ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä popup
function previewBonusPopup() {
    const data = getBonusOfferData();
    
    // –°–æ–∑–¥–∞—ë–º –ø—Ä–µ–≤—å—é overlay
    const overlay = document.createElement('div');
    overlay.style.cssText = `
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0,0,0,0.9);
        display: flex;
        justify-content: center;
        align-items: center;
        z-index: 10000;
    `;
    
    const popup = document.createElement('div');
    popup.style.cssText = `
        background: linear-gradient(145deg, #1a1a2e, #16213e);
        border-radius: 24px;
        max-width: 350px;
        width: 90%;
        overflow: hidden;
        box-shadow: 0 20px 60px rgba(0,0,0,0.5);
        border: 1px solid rgba(255,215,0,0.2);
    `;
    
    if (data.bonusType === 'image' && data.bonusImage) {
        popup.innerHTML = `
            <img src="${data.bonusImage}" style="width: 100%; display: block;">
            <div style="padding: 20px; display: flex; flex-direction: column; gap: 10px;">
                <button style="padding: 14px; border-radius: 25px; background: linear-gradient(45deg, #FFD700, #FFA500); color: #000; font-weight: bold; border: none; font-size: 15px;">
                    ${data.bonusButtonText}
                </button>
                <button style="padding: 12px; border-radius: 25px; background: transparent; color: #888; border: 1px solid #444; font-size: 14px;">
                    –ó–∞–∫—Ä—ã—Ç—å
                </button>
            </div>
        `;
    } else {
        popup.innerHTML = `
            <div style="padding: 30px; text-align: center;">
                <div style="font-size: 64px; margin-bottom: 15px;">üéÅ</div>
                <div style="color: #FFD700; font-size: 22px; font-weight: bold; margin-bottom: 10px;">${data.bonusTitle}</div>
                <div style="color: #CCC; font-size: 15px; line-height: 1.5; margin-bottom: 20px;">${data.bonusText}</div>
            </div>
            <div style="padding: 20px; background: rgba(0,0,0,0.3); display: flex; flex-direction: column; gap: 10px;">
                <button style="padding: 14px; border-radius: 25px; background: linear-gradient(45deg, #FFD700, #FFA500); color: #000; font-weight: bold; border: none; font-size: 15px;">
                    ${data.bonusButtonText}
                </button>
                <button style="padding: 12px; border-radius: 25px; background: transparent; color: #888; border: 1px solid #444; font-size: 14px;">
                    –ó–∞–∫—Ä—ã—Ç—å
                </button>
            </div>
        `;
    }
    
    overlay.appendChild(popup);
    overlay.onclick = (e) => {
        if (e.target === overlay) {
            document.body.removeChild(overlay);
        }
    };
    
    // –î–æ–±–∞–≤–ª—è–µ–º –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—é
    const hint = document.createElement('div');
    hint.style.cssText = 'position: absolute; bottom: 20px; left: 50%; transform: translateX(-50%); color: #888; font-size: 13px;';
    hint.textContent = '–ù–∞–∂–º–∏—Ç–µ –≤–Ω–µ popup —á—Ç–æ–±—ã –∑–∞–∫—Ä—ã—Ç—å';
    overlay.appendChild(hint);
    
    document.body.appendChild(overlay);
}

// –≠–∫—Å–ø–æ—Ä—Ç —Ñ—É–Ω–∫—Ü–∏–π
window.setBonusType = setBonusType;
window.handleBonusImageUpload = handleBonusImageUpload;
window.removeBonusImage = removeBonusImage;
window.updateBonusRequiredDisplay = updateBonusRequiredDisplay;
window.getBonusOfferData = getBonusOfferData;
window.previewBonusPopup = previewBonusPopup;
</script>

    <!-- CREATE BUTTON -->
    <button class="create-btn" id="createCardBtn" onclick="createCard()">
        <span id="createCard">Create Card</span>
    </button>

    <!-- PREVIEW MODAL -->
    <div id="previewModal" class="modal">
        <div class="modal-content">
            <button class="close-btn" onclick="closePreview()">√ó</button>
            <h2 class="modal-title">Card Preview</h2>
            <div id="previewContainer" class="preview-container">
                <span style="color: #666;" id="previewHere">Preview will be here</span>
            </div>
            <div style="margin-top: 20px; display: flex; gap: 10px;">
                <button onclick="closePreview()" style="flex: 1; background: #666; color: white; border: none; border-radius: 8px; padding: 10px;">‚úèÔ∏è <span id="edit">Edit</span></button>
                <button onclick="createCard(); closePreview();" style="flex: 1; background: linear-gradient(45deg, #43A047, #2E7D32); color: white; border: none; border-radius: 8px; padding: 10px;">‚úÖ <span id="create">Create</span></button>
            </div>
        </div>
    </div>

    <!-- LOADER -->
    <div id="loaderOverlay" class="loader-overlay">
        <div class="loader"></div>
        <div id="creating">Creating your card...</div>
    </div>

    <!-- RENDER CANVAS -->
    <canvas id="renderCanvas"></canvas>

<!-- NOTIFICATION CONTAINER -->
    <div id="notificationContainer" class="notification-container"></div>

    <!-- MODAL: TEMPLATES -->
    <div id="templatesModal" class="templates-modal">
        <div class="modal-overlay" onclick="closeTemplates()"></div>
        <div class="modal-content">
            <div class="modal-header">
                <h2>üìÇ <span id="templatesModalTitle">Ready Templates</span></h2>
                <button class="modal-close" onclick="closeTemplates()">‚úï</button>
            </div>
            <div class="modal-body" id="templatesList">
                <div class="loading">Loading...</div>
            </div>
        </div>
    </div>
    
<!-- Main Scripts -->
    <script src="/js/config.js?v=3"></script>
    <script src="/js/supabase.js?v=3"></script>
    <script src="/js/globalway-bridge.js?v=3"></script>
    <script src="/js/id-linking-service.js?v=3"></script>
    <script src="/js/common.js?v=3"></script>
    <script src="/js/generator.js?v=4"></script>
    <script src="/js/cloudinary.js?v=3"></script>
    
    <!-- PWA Auto Update (–≤–∫–ª—é—á–∞–µ—Ç —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—é SW) -->
    <script src="/js/pwa-updater.js"></script>
</body>
</html>
