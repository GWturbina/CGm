/* =====================================================
   CONTENT FILTER - Ğ¤Ğ¸Ğ»ÑŒÑ‚Ñ€ Ğ·Ğ°Ğ¿Ñ€ĞµÑ‰Ñ‘Ğ½Ğ½Ğ¾Ğ³Ğ¾ ĞºĞ¾Ğ½Ñ‚ĞµĞ½Ñ‚Ğ°
   v1.1 Ğ´Ğ»Ñ GlobalStudio / AI Studio
   
   Ğ˜Ğ¡ĞŸĞ ĞĞ’Ğ›Ğ•ĞĞ:
   - Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ»ĞµĞ½ whitelist Ğ´Ğ»Ñ Ğ±Ğ¸Ğ·Ğ½ĞµÑ-Ñ‚ĞµÑ€Ğ¼Ğ¸Ğ½Ğ¾Ğ²
   - Ğ£Ğ±Ñ€Ğ°Ğ½Ğ° Ğ°Ğ³Ñ€ĞµÑÑĞ¸Ğ²Ğ½Ğ°Ñ Ğ·Ğ°Ğ¼ĞµĞ½Ğ° Ğ»Ğ°Ñ‚Ğ¸Ğ½Ğ¸Ñ†Ñ‹ Ğ½Ğ° ĞºĞ¸Ñ€Ğ¸Ğ»Ğ»Ğ¸Ñ†Ñƒ
   - Ğ£Ğ»ÑƒÑ‡ÑˆĞµĞ½Ğ¾ Ğ»Ğ¾Ğ³Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ Ğ´Ğ»Ñ Ğ¾Ñ‚Ğ»Ğ°Ğ´ĞºĞ¸
   ===================================================== */

const ContentFilter = {
    
    // â­ WHITELIST - Ñ€Ğ°Ğ·Ñ€ĞµÑˆÑ‘Ğ½Ğ½Ñ‹Ğµ ÑĞ»Ğ¾Ğ²Ğ°/Ñ„Ñ€Ğ°Ğ·Ñ‹ (ĞĞ• Ğ±Ğ»Ğ¾ĞºĞ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ!)
    whitelist: [
        // ĞšÑ€Ğ¸Ğ¿Ñ‚Ğ¾Ğ²Ğ°Ğ»ÑÑ‚Ñ‹ Ğ¸ Ğ±Ğ»Ğ¾ĞºÑ‡ĞµĞ¹Ğ½
        'bnb', 'usdt', 'btc', 'eth', 'bitcoin', 'ethereum', 'ĞºÑ€Ğ¸Ğ¿Ñ‚Ğ¾Ğ²Ğ°Ğ»ÑÑ‚Ğ°', 'Ğ±Ğ»Ğ¾ĞºÑ‡ĞµĞ¹Ğ½', 'blockchain',
        'web3', 'web 3', 'defi', 'nft', 'Ñ‚Ğ¾ĞºĞµĞ½', 'token', 'ÑĞ¼Ğ°Ñ€Ñ‚-ĞºĞ¾Ğ½Ñ‚Ñ€Ğ°ĞºÑ‚', 'smart contract',
        'opbnb', 'binance', 'metamask', 'safepal', 'trustwallet',
        
        // Ğ‘Ğ¸Ğ·Ğ½ĞµÑ Ñ‚ĞµÑ€Ğ¼Ğ¸Ğ½Ñ‹  
        'Ğ´Ğ¾Ñ…Ğ¾Ğ´', 'Ğ²Ñ‹Ñ…Ğ¾Ğ´', 'Ğ¿ĞµĞ½ÑĞ¸Ñ', 'Ğ·Ğ°Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğ¾Ğº', 'Ğ¿Ñ€Ğ¸Ğ±Ñ‹Ğ»ÑŒ', 'Ğ¸Ğ½Ğ²ĞµÑÑ‚Ğ¸Ñ†Ğ¸Ğ¸', 'Ğ¸Ğ½Ğ²ĞµÑÑ‚Ğ¾Ñ€',
        'Ğ°ĞºĞ°Ğ´ĞµĞ¼Ğ¸Ñ', 'Ğ¾Ğ±ÑƒÑ‡ĞµĞ½Ğ¸Ğµ', 'ĞºÑƒÑ€Ñ', 'Ğ¿Ñ€Ğ¾Ğ³Ñ€Ğ°Ğ¼Ğ¼Ğ°', 'cardgift', 'globalway', 'globalstudio',
        
        // ĞœĞ°Ñ€ĞºĞµÑ‚Ğ¸Ğ½Ğ³
        'Ñ€Ğ°ÑÑÑ‹Ğ»ĞºĞ°', 'Ğ»Ğ¸ÑÑ‚Ğ¾Ğ²ĞºĞ°', 'Ğ±Ğ°Ğ½ĞµÑ€', 'Ğ±Ğ°Ğ½Ğ½ĞµÑ€', 'Ñ€ĞµĞºĞ»Ğ°Ğ¼Ğ°', 'ÑĞ»Ğ°Ğ¹Ğ´', 'Ğ¿Ñ€ĞµĞ·ĞµĞ½Ñ‚Ğ°Ñ†Ğ¸Ñ',
        'Ğ¼Ğ°Ñ€ĞºĞµÑ‚Ğ¸Ğ½Ğ³', 'Ğ¿Ñ€Ğ¾Ğ´Ğ²Ğ¸Ğ¶ĞµĞ½Ğ¸Ğµ', 'ĞºĞ¾Ğ½Ğ²ĞµÑ€ÑĞ¸Ñ', 'Ğ²Ğ¾Ñ€Ğ¾Ğ½ĞºĞ°',
        
        // Ğ¢ĞµÑ…Ğ½Ğ¸Ñ‡ĞµÑĞºĞ¾Ğµ
        'youtube', 'telegram', 'whatsapp', 'instagram', 'facebook', 'tiktok',
        'api', 'sdk', 'url', 'http', 'https', 'www'
    ],
    
    // ĞœĞ°Ñ‚ (Ñ€ÑƒÑÑĞºĞ¸Ğ¹ + Ğ°Ğ½Ğ³Ğ»Ğ¸Ğ¹ÑĞºĞ¸Ğ¹) - Ğ¢ĞĞ›Ğ¬ĞšĞ ÑĞ²Ğ½Ñ‹Ğµ ĞºĞ¾Ñ€Ğ½Ğ¸
    matRoots: [
        'Ñ…ÑƒĞ¹', 'Ñ…ÑƒÑ', 'Ñ…ÑƒĞµ', 'Ñ…ÑƒĞ¸', 'Ñ…ÑƒÑ',
        'Ğ¿Ğ¸Ğ·Ğ´', 'Ğ¿ĞµĞ·Ğ´',
        'Ğ±Ğ»ÑÑ‚ÑŒ', 'Ğ±Ğ»ÑĞ´ÑŒ', 'Ğ±Ğ»ÑĞ´', 'Ğ±Ğ»ÑÑ‚',
        'ĞµĞ±Ğ°Ñ‚', 'ĞµĞ±Ğ°Ğ»', 'ĞµĞ±Ğ°Ğ½', 'ĞµĞ±Ğ½Ñƒ', 'ĞµĞ±Ñ‘Ñ‚', 'ĞµĞ±ĞµÑ‚', 'ĞµĞ±Ğ»Ğ¸', 'ĞµĞ±Ğ»Ğ°', 'ĞµĞ±Ğ»Ğ¾', 'ĞµĞ±ÑƒÑ‡',
        'ÑÑƒĞºĞ°', 'ÑÑƒÑ‡Ğº', 'ÑÑƒÑ‡Ğ°Ñ€',
        'Ğ¼ÑƒĞ´Ğ°Ğº', 'Ğ¼ÑƒĞ´Ğ°Ñ‡', 'Ğ¼ÑƒĞ´Ğ¸Ğ»', 'Ğ¼ÑƒĞ´Ğ¾',
        'Ğ¿Ğ¸Ğ´Ğ¾Ñ€', 'Ğ¿Ğ¸Ğ´Ğ°Ñ€', 'Ğ¿Ğ¸Ğ´Ñ€', 'Ğ¿ĞµĞ´Ğ¸Ğº', 'Ğ¿ĞµĞ´ĞµÑ€',
        'Ğ·Ğ°Ğ»ÑƒĞ¿',
        'Ğ´ĞµÑ€ÑŒĞ¼', 'Ğ³Ğ¾Ğ²Ğ½Ğ¾', 'Ğ³Ğ¾Ğ²Ñ‘Ğ½', 'Ğ³Ğ¾Ğ²Ğ½',
        'Ğ²Ñ‹ĞµĞ±', 'Ğ·Ğ°ĞµĞ±', 'Ğ½Ğ°ĞµĞ±', 'Ğ¾Ñ‚ÑŠĞµĞ±', 'Ğ¿Ğ¾Ğ´ÑŠĞµĞ±', 'Ñ€Ğ°Ğ·ÑŠĞµĞ±', 'ÑƒĞµĞ±', 'Ğ²ÑŠĞµĞ±', 'Ğ´Ğ¾ĞµĞ±',
        'Ğ´Ğ¾Ğ»Ğ±Ğ¾Ñ‘Ğ±', 'Ğ´Ğ¾Ğ»Ğ±Ğ¾ĞµĞ±',
        'fuck', 'shit', 'bitch', 'asshole', 'cunt', 'whore',
        'Ğ½Ğ¸Ğ³ĞµÑ€', 'Ğ½Ğ¸Ğ³Ğ³ĞµÑ€', 'nigger', 'nigga'
    ],
    
    // ĞĞ°ÑĞ¸Ğ»Ğ¸Ğµ
    violenceWords: [
        'ÑƒĞ±Ğ¸Ñ‚ÑŒ', 'ÑƒĞ±ĞµĞ¹', 'ÑƒĞ±Ğ¸Ğ¹ÑÑ‚Ğ²', 'ÑƒĞ±Ğ¸Ğ²Ğ°Ñ',
        'Ğ·Ğ°Ñ€ĞµĞ·Ğ°Ñ‚ÑŒ', 'Ğ·Ğ°Ñ€ĞµĞ¶Ñƒ', 'Ğ·Ğ°Ñ€ĞµĞ·Ğ°Ğ»',
        'Ğ·Ğ°ÑÑ‚Ñ€ĞµĞ»Ğ¸Ñ‚ÑŒ', 'Ğ·Ğ°ÑÑ‚Ñ€ĞµĞ»Ñ', 'Ñ€Ğ°ÑÑÑ‚Ñ€ĞµĞ»',
        'Ğ²Ğ·Ğ¾Ñ€Ğ²Ğ°Ñ‚ÑŒ', 'Ğ²Ğ·Ğ¾Ñ€Ğ²Ñƒ',
        'Ğ¾Ñ‚Ñ€Ğ°Ğ²Ğ¸Ñ‚ÑŒ', 'Ğ¾Ñ‚Ñ€Ğ°Ğ²',
        'Ğ¿Ñ‹Ñ‚Ğ°Ñ‚ÑŒ', 'Ğ¿Ñ‹Ñ‚Ğº', 'Ğ¼ÑƒÑ‡Ğ¸Ñ‚ÑŒ',
        'Ğ½Ğ°ÑĞ¸Ğ»Ğ¾Ğ²Ğ°Ñ‚ÑŒ', 'Ğ¸Ğ·Ğ½Ğ°ÑĞ¸Ğ»', 'Ğ½Ğ°ÑĞ¸Ğ»ÑŒĞ½',
        'Ğ¸Ğ·Ğ±Ğ¸Ñ‚ÑŒ', 'Ğ¸Ğ·Ğ±Ğ¸ĞµĞ½Ğ¸',
        'Ñ‚ĞµÑ€Ñ€Ğ¾Ñ€Ğ¸Ğ·Ğ¼', 'Ñ‚ĞµÑ€Ñ€Ğ¾Ñ€Ğ¸ÑÑ‚', 'Ñ‚ĞµÑ€Ğ°ĞºÑ‚',
        'Ğ³ĞµĞ½Ğ¾Ñ†Ğ¸Ğ´',
        'ÑÑƒĞ¸Ñ†Ğ¸Ğ´', 'ÑĞ°Ğ¼Ğ¾ÑƒĞ±Ğ¸Ğ¹', 'Ğ¿Ğ¾Ğ²ĞµÑĞ¸Ñ‚ÑŒÑÑ', 'Ğ²ÑĞºÑ€Ñ‹Ñ‚ÑŒ Ğ²ĞµĞ½Ñ‹',
        'murder', 'rape', 'torture', 'terrorist'
    ],
    
    // ĞŸĞ¾Ñ€Ğ½Ğ¾Ğ³Ñ€Ğ°Ñ„Ğ¸Ñ Ğ¸ Ñ€Ğ°Ğ·Ğ²Ñ€Ğ°Ñ‚
    adultWords: [
        'Ğ¿Ğ¾Ñ€Ğ½Ğ¾', 'Ğ¿Ğ¾Ñ€Ğ½Ğ¾Ğ³Ñ€Ğ°Ñ„', 'porn',
        'ÑĞµĞºÑ Ñ Ğ´ĞµÑ‚ÑŒĞ¼Ğ¸', 'ÑĞµĞºÑ Ñ Ñ€ĞµĞ±ĞµĞ½ĞºĞ¾Ğ¼',
        'Ğ¾Ñ€Ğ³Ğ¸Ñ',
        'Ğ¼Ğ¸Ğ½ĞµÑ‚', 'Ğ¾Ñ‚ÑĞ¾Ñ',
        'Ğ¸Ğ½Ñ†ĞµÑÑ‚',
        'Ğ¿ĞµĞ´Ğ¾Ñ„Ğ¸Ğ»', 'Ğ¼Ğ°Ğ»Ğ¾Ğ»ĞµÑ‚Ğº',
        'Ğ¿Ñ€Ğ¾ÑÑ‚Ğ¸Ñ‚Ñƒ', 'ÑˆĞ»ÑÑ…Ğ°', 'Ğ´Ğ°Ğ²Ğ°Ğ»Ğº',
        'hentai', 'Ñ…ĞµĞ½Ñ‚Ğ°Ğ¹',
        'Ñ€Ğ°Ğ·Ğ²Ñ€Ğ°Ñ‚Ğ½', 'Ğ¸Ğ·Ğ²Ñ€Ğ°Ñ‰ĞµĞ½'
    ],
    
    // Ğ›Ğ“Ğ‘Ğ¢ Ğ¿Ñ€Ğ¾Ğ¿Ğ°Ğ³Ğ°Ğ½Ğ´Ğ°
    lgbtPropaganda: [
        'Ğ³ĞµĞ¹ Ğ¿Ğ°Ñ€Ğ°Ğ´', 'Ğ³ĞµĞ¹-Ğ¿Ğ°Ñ€Ğ°Ğ´', 'Ğ¿Ñ€Ğ°Ğ¹Ğ´',
        'ÑĞ¼ĞµĞ½Ğ° Ğ¿Ğ¾Ğ»Ğ° Ñ€ĞµĞ±ĞµĞ½Ğº',
        'Ğ¾Ğ´Ğ½Ğ¾Ğ¿Ğ¾Ğ»Ñ‹Ğ¹ Ğ±Ñ€Ğ°Ğº', 'Ğ¾Ğ´Ğ½Ğ¾Ğ¿Ğ¾Ğ»Ñ‹Ğµ Ğ¾Ñ‚Ğ½Ğ¾ÑˆĞµĞ½Ğ¸Ñ'
    ],
    
    // ĞœĞµĞ¶Ğ½Ğ°Ñ†Ğ¸Ğ¾Ğ½Ğ°Ğ»ÑŒĞ½Ğ°Ñ Ğ²Ñ€Ğ°Ğ¶Ğ´Ğ°
    hateSpeech: [
        'Ñ…Ğ¾Ñ…Ğ¾Ğ»', 'Ñ…Ğ¾Ñ…Ğ»', 'Ğ±Ğ°Ğ½Ğ´ĞµÑ€Ğ¾Ğ²ĞµÑ†',
        'Ğ¼Ğ¾ÑĞºĞ°Ğ»ÑŒ', 'ĞºĞ°Ñ†Ğ°Ğ¿', 'Ñ€Ğ°ÑˆĞ¸ÑÑ‚',
        'Ñ‡ÑƒÑ€ĞºĞ°', 'Ñ‡ĞµÑ€Ğ½Ğ¾Ğ¶Ğ¾Ğ¿',
        'ÑĞ¼ĞµÑ€Ñ‚ÑŒ Ğ²ÑĞµĞ¼', 'ÑƒĞ±Ğ¸Ğ²Ğ°Ñ‚ÑŒ Ğ²ÑĞµÑ…',
        'ÑƒĞ½Ğ¸Ñ‡Ñ‚Ğ¾Ğ¶Ğ¸Ñ‚ÑŒ Ğ²ÑĞµÑ…',
        'Ğ±ĞµĞ»Ğ°Ñ Ñ€Ğ°ÑĞ° Ğ¿Ñ€ĞµĞ²Ğ¾ÑÑ…Ğ¾Ğ´', 'Ğ°Ñ€Ğ¸Ğ¹ÑĞºĞ°Ñ Ñ€Ğ°ÑĞ°',
        'Ğ½Ğ°Ñ†Ğ¸ÑÑ‚', 'Ñ„Ğ°ÑˆĞ¸ÑÑ‚', 'ÑĞ²Ğ°ÑÑ‚Ğ¸Ğº', 'Ğ·Ğ¸Ğ³ Ñ…Ğ°Ğ¹Ğ»', 'heil hitler'
    ],
    
    // ĞĞ°Ñ€ĞºĞ¾Ñ‚Ğ¸ĞºĞ¸ (Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ ÑĞ²Ğ½Ñ‹Ğµ)
    drugsWords: [
        'Ğ³ĞµÑ€Ğ¾Ğ¸Ğ½', 'ĞºĞ¾ĞºĞ°Ğ¸Ğ½', 'Ğ¼ĞµÑ‚Ğ°Ğ¼Ñ„ĞµÑ‚Ğ°Ğ¼Ğ¸Ğ½',
        'ÑĞºÑÑ‚Ğ°Ğ·Ğ¸', 'Ğ·Ğ°ĞºĞ»Ğ°Ğ´ĞºĞ° Ğ½Ğ°Ñ€ĞºĞ¾Ñ‚Ğ¸Ğº', 'Ğ±Ğ°Ñ€Ñ‹Ğ³Ğ°', 'Ğ½Ğ°Ñ€ĞºĞ¾Ğ´Ğ¸Ğ»ĞµÑ€',
        'ÑĞ¿Ğ°Ğ¹Ñ', 'ÑĞ¾Ğ»ÑŒ Ğ´Ğ»Ñ Ğ²Ğ°Ğ½Ğ½'
    ],
    
    // Ğ­ĞºÑÑ‚Ñ€ĞµĞ¼Ğ¸Ğ·Ğ¼
    extremismWords: [
        'Ğ´Ğ¶Ğ¸Ñ…Ğ°Ğ´', 'ÑˆĞ°Ñ…Ğ¸Ğ´', 'Ğ¸Ğ³Ğ¸Ğ»', 'isis', 'Ñ‚Ğ°Ğ»Ğ¸Ğ±Ğ°Ğ½',
        'Ğ²Ğ·Ğ¾Ñ€Ğ²Ğ°Ñ‚ÑŒ ÑˆĞºĞ¾Ğ»', 'Ğ²Ğ·Ğ¾Ñ€Ğ²Ğ°Ñ‚ÑŒ Ğ¼ĞµÑ‚Ñ€Ğ¾',
        'Ğ¼Ğ°ÑÑĞ¾Ğ²Ñ‹Ğ¹ Ñ€Ğ°ÑÑÑ‚Ñ€ĞµĞ»', 'ÑÑ‚Ñ€ĞµĞ»ÑŒĞ±Ğ° Ğ² ÑˆĞºĞ¾Ğ»Ğµ',
        'ĞºĞ°Ğº ÑĞ´ĞµĞ»Ğ°Ñ‚ÑŒ Ğ±Ğ¾Ğ¼Ğ±Ñƒ', 'ĞºĞ°Ğº ÑĞ´ĞµĞ»Ğ°Ñ‚ÑŒ Ğ²Ğ·Ñ€Ñ‹Ğ²Ñ‡Ğ°Ñ‚ĞºÑƒ',
        'Ñ€ĞµÑ†ĞµĞ¿Ñ‚ ÑĞ´Ğ°', 'ĞºĞ°Ğº Ğ¾Ñ‚Ñ€Ğ°Ğ²Ğ¸Ñ‚ÑŒ'
    ],
    
    /**
     * ĞŸÑ€Ğ¾Ğ²ĞµÑ€Ğ¸Ñ‚ÑŒ Ñ‚ĞµĞºÑÑ‚ Ğ½Ğ° Ğ·Ğ°Ğ¿Ñ€ĞµÑ‰Ñ‘Ğ½Ğ½Ñ‹Ğ¹ ĞºĞ¾Ğ½Ñ‚ĞµĞ½Ñ‚
     */
    check(text) {
        if (!text || typeof text !== 'string') {
            return { allowed: true, reason: null, category: null };
        }
        
        // Ğ Ğ°Ğ±Ğ¾Ñ‚Ğ°ĞµĞ¼ Ñ Ğ¾Ñ€Ğ¸Ğ³Ğ¸Ğ½Ğ°Ğ»ÑŒĞ½Ñ‹Ğ¼ Ñ‚ĞµĞºÑÑ‚Ğ¾Ğ¼ Ğ² Ğ½Ğ¸Ğ¶Ğ½ĞµĞ¼ Ñ€ĞµĞ³Ğ¸ÑÑ‚Ñ€Ğµ
        const lowerText = text.toLowerCase();
        
        // Ğ”Ğ»Ñ Ğ¾Ğ±Ñ…Ğ¾Ğ´Ğ° Ñ„Ğ¸Ğ»ÑŒÑ‚Ñ€Ğ° (Ğ·Ğ°Ğ¼ĞµĞ½Ñ‹ Ñ†Ğ¸Ñ„Ñ€ Ğ½Ğ° Ğ±ÑƒĞºĞ²Ñ‹)
        const normalized = this.normalizeText(text);
        
        console.log('ğŸ” ContentFilter checking:', text.substring(0, 100) + (text.length > 100 ? '...' : ''));
        
        const checks = [
            { words: this.matRoots, category: 'mat', reason: 'ĞĞµÑ†ĞµĞ½Ğ·ÑƒÑ€Ğ½Ğ°Ñ Ğ»ĞµĞºÑĞ¸ĞºĞ° Ğ·Ğ°Ğ¿Ñ€ĞµÑ‰ĞµĞ½Ğ°' },
            { words: this.violenceWords, category: 'violence', reason: 'ĞšĞ¾Ğ½Ñ‚ĞµĞ½Ñ‚ Ñ Ğ½Ğ°ÑĞ¸Ğ»Ğ¸ĞµĞ¼ Ğ·Ğ°Ğ¿Ñ€ĞµÑ‰Ñ‘Ğ½' },
            { words: this.adultWords, category: 'adult', reason: 'ĞšĞ¾Ğ½Ñ‚ĞµĞ½Ñ‚ Ğ´Ğ»Ñ Ğ²Ğ·Ñ€Ğ¾ÑĞ»Ñ‹Ñ… Ğ·Ğ°Ğ¿Ñ€ĞµÑ‰Ñ‘Ğ½' },
            { words: this.lgbtPropaganda, category: 'lgbt', reason: 'Ğ”Ğ°Ğ½Ğ½Ñ‹Ğ¹ ĞºĞ¾Ğ½Ñ‚ĞµĞ½Ñ‚ Ğ·Ğ°Ğ¿Ñ€ĞµÑ‰Ñ‘Ğ½' },
            { words: this.hateSpeech, category: 'hate', reason: 'Ğ Ğ°Ğ·Ğ¶Ğ¸Ğ³Ğ°Ğ½Ğ¸Ğµ Ğ½ĞµĞ½Ğ°Ğ²Ğ¸ÑÑ‚Ğ¸ Ğ·Ğ°Ğ¿Ñ€ĞµÑ‰ĞµĞ½Ğ¾' },
            { words: this.drugsWords, category: 'drugs', reason: 'ĞšĞ¾Ğ½Ñ‚ĞµĞ½Ñ‚ Ğ¾ Ğ½Ğ°Ñ€ĞºĞ¾Ñ‚Ğ¸ĞºĞ°Ñ… Ğ·Ğ°Ğ¿Ñ€ĞµÑ‰Ñ‘Ğ½' },
            { words: this.extremismWords, category: 'extremism', reason: 'Ğ­ĞºÑÑ‚Ñ€ĞµĞ¼Ğ¸ÑÑ‚ÑĞºĞ¸Ğ¹ ĞºĞ¾Ğ½Ñ‚ĞµĞ½Ñ‚ Ğ·Ğ°Ğ¿Ñ€ĞµÑ‰Ñ‘Ğ½' }
        ];
        
        for (const check of checks) {
            const found = this.findForbiddenWord(lowerText, normalized, check.words);
            if (found) {
                console.log(`ğŸš« ContentFilter: blocked "${found}" (${check.category})`);
                return {
                    allowed: false,
                    reason: check.reason,
                    category: check.category,
                    word: found
                };
            }
        }
        
        console.log('âœ… ContentFilter: Text is clean');
        return { allowed: true, reason: null, category: null };
    },
    
    isAllowed(text) {
        return this.check(text).allowed;
    },
    
    /**
     * â­ Ğ‘Ğ•Ğ—ĞĞŸĞĞ¡ĞĞĞ¯ Ğ½Ğ¾Ñ€Ğ¼Ğ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ - Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ Ğ´Ğ»Ñ Ğ¾Ğ±Ñ…Ğ¾Ğ´Ğ° Ñ„Ğ¸Ğ»ÑŒÑ‚Ñ€Ğ° Ñ‡ĞµÑ€ĞµĞ· Ñ†Ğ¸Ñ„Ñ€Ñ‹
     * ĞĞ• Ğ·Ğ°Ğ¼ĞµĞ½ÑĞµĞ¼ Ğ»Ğ°Ñ‚Ğ¸Ğ½Ğ¸Ñ†Ñƒ Ğ½Ğ° ĞºĞ¸Ñ€Ğ¸Ğ»Ğ»Ğ¸Ñ†Ñƒ!
     */
    normalizeText(text) {
        return text
            .toLowerCase()
            // Ğ¢Ğ¾Ğ»ÑŒĞºĞ¾ Ğ·Ğ°Ğ¼ĞµĞ½Ñ‹ Ñ†Ğ¸Ñ„Ñ€ Ğ½Ğ° Ğ±ÑƒĞºĞ²Ñ‹ (Ğ´Ğ»Ñ Ğ¾Ğ±Ñ…Ğ¾Ğ´Ğ° Ñ‚Ğ¸Ğ¿Ğ° "Ñ…0Ğ¹" -> "Ñ…Ğ¾Ğ¹")
            .replace(/0/g, 'Ğ¾')
            .replace(/3/g, 'Ğµ')
            .replace(/4/g, 'Ğ°')
            .replace(/@/g, 'Ğ°')
            // Ğ£Ğ±Ğ¸Ñ€Ğ°ĞµĞ¼ Ğ¿Ğ¾Ğ²Ñ‚Ğ¾Ñ€ÑÑÑ‰Ğ¸ĞµÑÑ ÑĞ¸Ğ¼Ğ²Ğ¾Ğ»Ñ‹ (Ğ°Ğ°Ğ°Ğ°Ğ° -> Ğ°Ğ°)
            .replace(/(.)\1{2,}/g, '$1$1')
            .replace(/\s+/g, ' ')
            .trim();
    },
    
    /**
     * â­ Ğ£Ğ»ÑƒÑ‡ÑˆĞµĞ½Ğ½Ñ‹Ğ¹ Ğ¿Ğ¾Ğ¸ÑĞº Ğ·Ğ°Ğ¿Ñ€ĞµÑ‰Ñ‘Ğ½Ğ½Ñ‹Ñ… ÑĞ»Ğ¾Ğ²
     */
    findForbiddenWord(lowerText, normalizedText, wordList) {
        for (const word of wordList) {
            const wordLower = word.toLowerCase();
            
            // ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞµĞ¼ Ğ² Ğ¾Ñ€Ğ¸Ğ³Ğ¸Ğ½Ğ°Ğ»ÑŒĞ½Ğ¾Ğ¼ Ñ‚ĞµĞºÑÑ‚Ğµ
            if (lowerText.includes(wordLower)) {
                // ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞµĞ¼ Ñ‡Ñ‚Ğ¾ ÑÑ‚Ğ¾ ĞĞ• Ñ‡Ğ°ÑÑ‚ÑŒ Ñ€Ğ°Ğ·Ñ€ĞµÑˆÑ‘Ğ½Ğ½Ğ¾Ğ³Ğ¾ ÑĞ»Ğ¾Ğ²Ğ°
                if (!this.isPartOfWhitelistedWord(lowerText, wordLower)) {
                    return word;
                }
            }
            
            // ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞµĞ¼ Ğ² Ğ½Ğ¾Ñ€Ğ¼Ğ°Ğ»Ğ¸Ğ·Ğ¾Ğ²Ğ°Ğ½Ğ½Ğ¾Ğ¼ (Ğ´Ğ»Ñ Ğ¾Ğ±Ñ…Ğ¾Ğ´Ğ° Ñ‡ĞµÑ€ĞµĞ· Ñ†Ğ¸Ñ„Ñ€Ñ‹)
            if (normalizedText !== lowerText && normalizedText.includes(wordLower)) {
                if (!this.isPartOfWhitelistedWord(normalizedText, wordLower)) {
                    return word;
                }
            }
        }
        
        return null;
    },
    
    /**
     * â­ ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ°: Ğ½Ğµ ÑĞ²Ğ»ÑĞµÑ‚ÑÑ Ğ»Ğ¸ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½Ğ½Ğ¾Ğµ ÑĞ»Ğ¾Ğ²Ğ¾ Ñ‡Ğ°ÑÑ‚ÑŒÑ Ñ€Ğ°Ğ·Ñ€ĞµÑˆÑ‘Ğ½Ğ½Ğ¾Ğ³Ğ¾
     */
    isPartOfWhitelistedWord(text, foundWord) {
        for (const whiteWord of this.whitelist) {
            const whiteLower = whiteWord.toLowerCase();
            // Ğ•ÑĞ»Ğ¸ Ñ€Ğ°Ğ·Ñ€ĞµÑˆÑ‘Ğ½Ğ½Ğ¾Ğµ ÑĞ»Ğ¾Ğ²Ğ¾ ÑĞ¾Ğ´ĞµÑ€Ğ¶Ğ¸Ñ‚ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½Ğ½Ğ¾Ğµ "Ğ¿Ğ»Ğ¾Ñ…Ğ¾Ğµ" ÑĞ»Ğ¾Ğ²Ğ¾
            // Ğ˜ Ñ‚ĞµĞºÑÑ‚ ÑĞ¾Ğ´ĞµÑ€Ğ¶Ğ¸Ñ‚ ÑÑ‚Ğ¾ Ñ€Ğ°Ğ·Ñ€ĞµÑˆÑ‘Ğ½Ğ½Ğ¾Ğµ ÑĞ»Ğ¾Ğ²Ğ¾ â€” Ğ¿Ñ€Ğ¾Ğ¿ÑƒÑĞºĞ°ĞµĞ¼
            if (whiteLower.includes(foundWord) && text.includes(whiteLower)) {
                console.log(`â„¹ï¸ "${foundWord}" is part of whitelisted "${whiteWord}", skipping`);
                return true;
            }
        }
        return false;
    },
    
    /**
     * Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ ÑĞ»Ğ¾Ğ²Ğ¾ Ğ² ĞºĞ°Ñ‚ĞµĞ³Ğ¾Ñ€Ğ¸Ñ
     */
    addWord(category, word) {
        const categories = {
            'mat': this.matRoots,
            'violence': this.violenceWords,
            'adult': this.adultWords,
            'lgbt': this.lgbtPropaganda,
            'hate': this.hateSpeech,
            'drugs': this.drugsWords,
            'extremism': this.extremismWords,
            'whitelist': this.whitelist
        };
        
        if (categories[category]) {
            categories[category].push(word.toLowerCase());
            console.log(`âœ… Added "${word}" to ${category}`);
            return true;
        }
        return false;
    },
    
    /**
     * â­ Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ ÑĞ»Ğ¾Ğ²Ğ¾ Ğ² whitelist
     */
    addToWhitelist(word) {
        this.whitelist.push(word.toLowerCase());
        console.log(`âœ… Added "${word}" to whitelist`);
    },
    
    /**
     * â­ Ğ£Ğ´Ğ°Ğ»Ğ¸Ñ‚ÑŒ ÑĞ»Ğ¾Ğ²Ğ¾ Ğ¸Ğ· whitelist
     */
    removeFromWhitelist(word) {
        const index = this.whitelist.indexOf(word.toLowerCase());
        if (index > -1) {
            this.whitelist.splice(index, 1);
            console.log(`âœ… Removed "${word}" from whitelist`);
            return true;
        }
        return false;
    }
};

window.ContentFilter = ContentFilter;
console.log('ğŸ›¡ï¸ ContentFilter v1.1 loaded (with whitelist)');
